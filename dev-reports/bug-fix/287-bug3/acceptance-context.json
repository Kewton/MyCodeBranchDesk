{
  "bug_id": "287-bug3",
  "bug_description": "prompt-detector.ts の detectMultipleChoicePrompt() が Claude の過去の会話テキスト内の番号付きリストを active な multiple_choice プロンプトとして誤検出する",
  "fix_summary": "Pass 2 逆方向スキャンに ❯ (U+276F) バリアを追加。collectedOptions === 0 かつ行が ❯ で始まる場合にスキャンを停止し、過去のテキストへの到達を防止。",
  "acceptance_criteria": [
    "過去の会話テキスト内の番号付きリストが multiple_choice プロンプトとして誤検出されないこと",
    "アクティブな multiple_choice プロンプト（❯ 1. Yes 等）は引き続き正常に検出されること",
    "requireDefaultIndicator=false (Claude) と true (その他) の両方で正常動作すること",
    "既存テスト（prompt-detector.test.ts 165件）が全てパスすること",
    "新規テストケース（4件）が追加されていること",
    "ESLint/TypeScript エラーが 0 件であること",
    "ビルドが成功すること"
  ],
  "test_scenarios": [
    "シナリオ1: prompt-detector.test.ts の全165テストがパスすること",
    "シナリオ2: TypeScript型チェック（npx tsc --noEmit）がエラー0件であること",
    "シナリオ3: ESLint（npm run lint）がエラー・警告0件であること",
    "シナリオ4: ビルド（npm run build）が成功すること",
    "シナリオ5: prompt-detector.ts にバリアロジック（❯ U+276F チェック）が追加されていること",
    "シナリオ6: auto-yes-manager.test.ts の全テストがパスすること（間接影響確認）",
    "シナリオ7: 全ユニットテスト（npm run test:unit）がパスすること"
  ],
  "related_files": [
    "src/lib/prompt-detector.ts",
    "tests/unit/prompt-detector.test.ts"
  ]
}
