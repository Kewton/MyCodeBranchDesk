{"body":"## æ¦‚è¦\n\nGit worktree ã‚’æ´»ç”¨ã—ãŸä¸¦åˆ—é–‹ç™ºç’°å¢ƒã‚’æ•´å‚™ã—ã€è¤‡æ•°ã® Issue/æ©Ÿèƒ½ã‚’åŒæ™‚ã«é–‹ç™ºã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ã€‚\n\n## èƒŒæ™¯\n\nç¾çŠ¶ã®é–‹ç™ºãƒ•ãƒ­ãƒ¼ã§ã¯å˜ä¸€ãƒ–ãƒ©ãƒ³ãƒã§ã®ä½œæ¥­ãŒå‰æã¨ãªã£ã¦ãŠã‚Šã€è¤‡æ•°ã®æ©Ÿèƒ½é–‹ç™ºã‚’ä¸¦åˆ—ã§é€²ã‚ã‚‹éš›ã«ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚¹ã‚¤ãƒƒãƒã®ã‚³ã‚¹ãƒˆãŒç™ºç”Ÿã—ã¦ã„ã‚‹ã€‚Git worktree ã‚’æ´»ç”¨ã™ã‚‹ã“ã¨ã§ã€å„ Issue ã”ã¨ã«ç‹¬ç«‹ã—ãŸé–‹ç™ºç’°å¢ƒã‚’æŒã¡ã€åŠ¹ç‡çš„ãªä¸¦åˆ—é–‹ç™ºã‚’å®Ÿç¾ã—ãŸã„ã€‚\n\n## ãƒ–ãƒ©ãƒ³ãƒæˆ¦ç•¥ã®å¤‰æ›´\n\n### ç¾çŠ¶\n```\nmain â† feature/*/fix/*/hotfix/* (PRãƒãƒ¼ã‚¸)\n```\n\n### å¤‰æ›´å¾Œ\n```\nmain â† develop â† feature/*/fix/*/hotfix/*\n\nãƒ•ãƒ­ãƒ¼:\n1. develop ã‹ã‚‰ feature/* ãƒ–ãƒ©ãƒ³ãƒã‚’ä½œæˆ\n2. feature/* ã§é–‹ç™º\n3. develop ã«ãƒãƒ¼ã‚¸ã—ã¦å‹•ä½œç¢ºèª\n4. OK ãªã‚‰ã° develop ã‚’ main ã«ãƒãƒ¼ã‚¸ã—ã¦ãƒªãƒªãƒ¼ã‚¹\n```\n\n## è¦ä»¶\n\n### 1. ãƒ–ãƒ©ãƒ³ãƒæˆ¦ç•¥ã®æ›´æ–°\n\n- [ ] CLAUDE.md ã®ãƒ–ãƒ©ãƒ³ãƒæˆ¦ç•¥ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’æ›´æ–°\n- [ ] develop ãƒ–ãƒ©ãƒ³ãƒã®ä½œæˆã¨ä¿è­·ãƒ«ãƒ¼ãƒ«è¨­å®š\n- [ ] PR ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®æ›´æ–°ï¼ˆdevelop å‘ã‘ / main å‘ã‘ï¼‰\n- [ ] CI/CD ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®æ›´æ–°ï¼ˆdevelop ãƒ–ãƒ©ãƒ³ãƒå¯¾å¿œï¼‰\n\n### 2. Worktree åˆ¥ãƒªã‚½ãƒ¼ã‚¹åˆ†é›¢\n\n#### 2.1 ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åˆ†é›¢\n- [ ] Worktree ã”ã¨ã«ç‹¬ç«‹ã—ãŸ DB ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½¿ç”¨\n  - ãƒ‘ã‚¹ä¾‹: `~/.commandmate/data/cm-{issue-no}.db`\n- [ ] `src/lib/db-path-resolver.ts` ã®ä¿®æ­£\n- [ ] ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ­ã‚¸ãƒƒã‚¯ã® Worktree å¯¾å¿œ\n\n#### 2.2 ãƒãƒ¼ãƒˆè‡ªå‹•å‰²ã‚Šå½“ã¦\n- [ ] `--auto-port` ãƒ•ãƒ©ã‚°ã®è¿½åŠ ï¼ˆ`commandmate start`ï¼‰\n- [ ] ç©ºããƒãƒ¼ãƒˆæ¤œå‡ºãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã®ä½œæˆ\n  - `src/cli/utils/port-allocator.ts`\n- [ ] Worktree åˆ¥ `.env` ã¸ã®ãƒãƒ¼ãƒˆè¨˜éŒ²\n\n#### 2.3 PID ãƒ•ã‚¡ã‚¤ãƒ«åˆ†é›¢\n- [ ] Worktree ã”ã¨ã® PID ãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†\n  - ãƒ‘ã‚¹ä¾‹: `~/.commandmate/pids/{issue-no}.pid`\n- [ ] `src/cli/utils/pid-manager.ts` ã®ä¿®æ­£\n\n#### 2.4 ãƒ­ã‚°åˆ†é›¢\n- [ ] Worktree ã”ã¨ã®ãƒ­ã‚°ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª\n  - ãƒ‘ã‚¹ä¾‹: `~/.commandmate/logs/{issue-no}/`\n\n### 3. CommandMate External Apps é€£æº\n\nCommandMate ã®ã€ŒExternal Appsã€æ©Ÿèƒ½ã‹ã‚‰å„ Worktree ã®ã‚µãƒ¼ãƒãƒ¼ã«ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ã«ã™ã‚‹ã€‚\n\n- [ ] ãƒ—ãƒ­ã‚­ã‚·ãƒ‘ã‚¹è¨­å®š: `proxy/commandmate_issue/{issue-no}`\n- [ ] Worktree ã‚µãƒ¼ãƒãƒ¼ã¸ã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°è¨­å®š\n- [ ] External Apps UI ã‹ã‚‰ã®ã‚¢ã‚¯ã‚»ã‚¹å¯¾å¿œ\n\n```\nã‚¢ã‚¯ã‚»ã‚¹ãƒ‘ã‚¹ä¾‹:\nhttp://localhost:3000/proxy/commandmate_issue/135\n  â†’ Worktree #135 ã®ã‚µãƒ¼ãƒãƒ¼ï¼ˆä¾‹: localhost:3001ï¼‰ã«ãƒ—ãƒ­ã‚­ã‚·\n```\n\n### 4. Claude Code ã‚¹ã‚­ãƒ«: /worktree-setup\n\nIssue ç•ªå·ã‚’æŒ‡å®šã—ã¦ Worktree ç’°å¢ƒã‚’è‡ªå‹•ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã™ã‚‹ã‚¹ã‚­ãƒ«ã‚’ä½œæˆã€‚\n\n```bash\n/worktree-setup 135\n```\n\n**å®Ÿè¡Œå†…å®¹:**\n1. `git worktree add` ã§æ–°è¦ Worktree ä½œæˆ\n   - ãƒ‘ã‚¹: `~/repos/commandmate-issue-{issue-no}`\n   - ãƒ–ãƒ©ãƒ³ãƒ: `feature/{issue-no}-xxx` ã¾ãŸã¯ `fix/{issue-no}-xxx`\n2. Worktree ç”¨ `.env` ãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆ\n   - `CM_PORT`: è‡ªå‹•å‰²ã‚Šå½“ã¦\n   - `CM_DB_PATH`: Worktree å°‚ç”¨ãƒ‘ã‚¹\n   - `CM_LOG_DIR`: Worktree å°‚ç”¨ãƒ‘ã‚¹\n3. `npm install` å®Ÿè¡Œ\n4. `npm run build:all` å®Ÿè¡Œ\n5. `commandmate start --daemon` ã§ã‚µãƒ¼ãƒãƒ¼èµ·å‹•\n6. External Apps ã¸ã®ç™»éŒ²ï¼ˆproxy è¨­å®šï¼‰\n\n**å‡ºåŠ›ä¾‹:**\n```\nâœ… Worktree ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—å®Œäº†ï¼\n\nğŸ“ Worktree ãƒ‘ã‚¹: ~/repos/commandmate-issue-135\nğŸŒ¿ ãƒ–ãƒ©ãƒ³ãƒ: feature/135-xxx\nğŸŒ ã‚µãƒ¼ãƒãƒ¼ URL: http://localhost:3001\nğŸ”— External Apps: /proxy/commandmate_issue/135\n\næ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—:\n  cd ~/repos/commandmate-issue-135\n  code .  # ã¾ãŸã¯ claude\n```\n\n### 5. Claude Code ã‚¹ã‚­ãƒ«: /worktree-cleanup\n\nIssue ç•ªå·ã‚’æŒ‡å®šã—ã¦ Worktree ç’°å¢ƒã‚’ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã™ã‚‹ã‚¹ã‚­ãƒ«ã‚’ä½œæˆã€‚\n\n```bash\n/worktree-cleanup 135\n```\n\n**å®Ÿè¡Œå†…å®¹:**\n1. `commandmate stop` ã§ã‚µãƒ¼ãƒãƒ¼åœæ­¢\n2. External Apps ç™»éŒ²è§£é™¤\n3. PID ãƒ•ã‚¡ã‚¤ãƒ«å‰Šé™¤\n4. `git worktree remove` ã§ Worktree å‰Šé™¤\n5. ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰DB ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã¾ãŸã¯å‰Šé™¤\n\n**å‡ºåŠ›ä¾‹:**\n```\nâœ… Worktree ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—å®Œäº†ï¼\n\nğŸ—‘ï¸ å‰Šé™¤æ¸ˆã¿:\n  - Worktree: ~/repos/commandmate-issue-135\n  - PID ãƒ•ã‚¡ã‚¤ãƒ«: ~/.commandmate/pids/135.pid\n  - External Apps ç™»éŒ²\n\nğŸ“¦ ä¿æŒæ¸ˆã¿:\n  - DB ãƒ•ã‚¡ã‚¤ãƒ«: ~/.commandmate/data/cm-135.db\n    ï¼ˆå‰Šé™¤ã™ã‚‹å ´åˆ: rm ~/.commandmate/data/cm-135.dbï¼‰\n```\n\n### 6. Worktree è­˜åˆ¥ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£\n\n- [ ] `src/cli/utils/worktree-detector.ts` æ–°è¦ä½œæˆ\n  - ç¾åœ¨ã® Worktree ã‚’æ¤œå‡º\n  - Issue ç•ªå·ã‚’æŠ½å‡º\n  - Worktree ID ã‚’ç”Ÿæˆ\n\n## æŠ€è¡“è¨­è¨ˆ\n\n### ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆï¼ˆWorktree ç’°å¢ƒï¼‰\n\n```\n~/.commandmate/\nâ”œâ”€â”€ .env                    # ã‚°ãƒ­ãƒ¼ãƒãƒ«è¨­å®šï¼ˆAUTH_TOKEN ç­‰ï¼‰\nâ”œâ”€â”€ data/\nâ”‚   â”œâ”€â”€ cm.db               # ãƒ¡ã‚¤ãƒ³ï¼ˆdevelop/mainï¼‰ç”¨\nâ”‚   â”œâ”€â”€ cm-135.db           # Issue #135 ç”¨\nâ”‚   â””â”€â”€ cm-200.db           # Issue #200 ç”¨\nâ”œâ”€â”€ pids/\nâ”‚   â”œâ”€â”€ main.pid\nâ”‚   â”œâ”€â”€ 135.pid\nâ”‚   â””â”€â”€ 200.pid\nâ””â”€â”€ logs/\n    â”œâ”€â”€ main/\n    â”œâ”€â”€ 135/\n    â””â”€â”€ 200/\n\n~/repos/\nâ”œâ”€â”€ CommandMate/            # ãƒ¡ã‚¤ãƒ³ï¼ˆdevelop ãƒ–ãƒ©ãƒ³ãƒï¼‰\nâ”œâ”€â”€ commandmate-issue-135/  # Worktree #135\nâ””â”€â”€ commandmate-issue-200/  # Worktree #200\n```\n\n### ãƒ—ãƒ­ã‚­ã‚·ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°è¨­è¨ˆ\n\n```typescript\n// External Apps ãƒ—ãƒ­ã‚­ã‚·è¨­å®š\n// /proxy/commandmate_issue/:issueNo/* -> localhost:{port}/*\n\n// ãƒãƒ¼ãƒˆãƒãƒƒãƒ”ãƒ³ã‚°ç®¡ç†\n// ~/.commandmate/worktree-ports.json\n{\n  \"135\": { \"port\": 3001, \"path\": \"~/repos/commandmate-issue-135\" },\n  \"200\": { \"port\": 3002, \"path\": \"~/repos/commandmate-issue-200\" }\n}\n```\n\n### ç’°å¢ƒå¤‰æ•°èª­ã¿è¾¼ã¿é †åº\n\n```\n1. ~/.commandmate/.env        # ã‚°ãƒ­ãƒ¼ãƒãƒ«ï¼ˆAUTH_TOKEN, BIND ç­‰ï¼‰\n2. <worktree>/.env            # Worktree å›ºæœ‰ï¼ˆPORT, DB_PATH, LOG_DIRï¼‰\n3. ç’°å¢ƒå¤‰æ•°                    # æœ€å„ªå…ˆ\n```\n\n## å—å…¥æ¡ä»¶\n\n- [ ] develop ãƒ–ãƒ©ãƒ³ãƒãŒä½œæˆã•ã‚Œã€ä¿è­·ãƒ«ãƒ¼ãƒ«ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹\n- [ ] `/worktree-setup 999` ã§ Worktree ç’°å¢ƒãŒè‡ªå‹•æ§‹ç¯‰ã•ã‚Œã‚‹\n- [ ] è¤‡æ•°ã® Worktree ã‚µãƒ¼ãƒãƒ¼ãŒåŒæ™‚ã«èµ·å‹•ã§ãã‚‹ï¼ˆãƒãƒ¼ãƒˆç«¶åˆãªã—ï¼‰\n- [ ] External Apps ã‹ã‚‰ `proxy/commandmate_issue/{issue-no}` ã§ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹\n- [ ] `/worktree-cleanup 999` ã§ Worktree ç’°å¢ƒãŒã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã•ã‚Œã‚‹\n- [ ] å„ Worktree ãŒç‹¬ç«‹ã—ãŸ DB ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹\n- [ ] CLAUDE.md ã«ãƒ–ãƒ©ãƒ³ãƒæˆ¦ç•¥ã¨ Worktree é–‹ç™ºãƒ•ãƒ­ãƒ¼ãŒè¨˜è¼‰ã•ã‚Œã¦ã„ã‚‹\n- [ ] æ–°ã—ã„ã‚¹ã‚­ãƒ«ï¼ˆ/worktree-setup, /worktree-cleanupï¼‰ãŒãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆåŒ–ã•ã‚Œã¦ã„ã‚‹\n\n## å½±éŸ¿ç¯„å›²\n\n### å¤‰æ›´å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«\n\n| ãƒ•ã‚¡ã‚¤ãƒ« | å¤‰æ›´å†…å®¹ |\n|---------|---------|\n| `CLAUDE.md` | ãƒ–ãƒ©ãƒ³ãƒæˆ¦ç•¥ã€Worktree é–‹ç™ºãƒ•ãƒ­ãƒ¼è¿½è¨˜ |\n| `src/lib/db-path-resolver.ts` | Worktree ID å¯¾å¿œ |\n| `src/cli/utils/env-setup.ts` | Worktree åˆ¥ .env ç”Ÿæˆ |\n| `src/cli/utils/pid-manager.ts` | ãƒãƒ«ãƒ PID å¯¾å¿œ |\n| `src/cli/commands/start.ts` | `--auto-port` ãƒ•ãƒ©ã‚° |\n| `.github/workflows/*.yml` | develop ãƒ–ãƒ©ãƒ³ãƒå¯¾å¿œ |\n\n### æ–°è¦ä½œæˆãƒ•ã‚¡ã‚¤ãƒ«\n\n| ãƒ•ã‚¡ã‚¤ãƒ« | å†…å®¹ |\n|---------|------|\n| `src/cli/utils/worktree-detector.ts` | Worktree æ¤œå‡ºãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ |\n| `src/cli/utils/port-allocator.ts` | ãƒãƒ¼ãƒˆè‡ªå‹•å‰²ã‚Šå½“ã¦ |\n| `.claude/skills/worktree-setup/` | ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚¹ã‚­ãƒ« |\n| `.claude/skills/worktree-cleanup/` | ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã‚¹ã‚­ãƒ« |\n| `docs/dev-guide/worktree-development.md` | é–‹ç™ºè€…å‘ã‘ã‚¬ã‚¤ãƒ‰ |\n\n## å®Ÿè£…è¨ˆç”»\n\n### Phase 1: åŸºç›¤æ•´å‚™\n- ãƒ–ãƒ©ãƒ³ãƒæˆ¦ç•¥æ›´æ–°\n- Worktree è­˜åˆ¥ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£\n- ãƒãƒ¼ãƒˆè‡ªå‹•å‰²ã‚Šå½“ã¦\n\n### Phase 2: ãƒªã‚½ãƒ¼ã‚¹åˆ†é›¢\n- DB åˆ†é›¢\n- PID åˆ†é›¢\n- ãƒ­ã‚°åˆ†é›¢\n\n### Phase 3: CLI/ã‚¹ã‚­ãƒ«\n- `--auto-port` ãƒ•ãƒ©ã‚°\n- `/worktree-setup` ã‚¹ã‚­ãƒ«\n- `/worktree-cleanup` ã‚¹ã‚­ãƒ«\n\n### Phase 4: External Apps é€£æº\n- ãƒ—ãƒ­ã‚­ã‚·ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°\n- ãƒãƒ¼ãƒˆãƒãƒƒãƒ”ãƒ³ã‚°ç®¡ç†\n- UI å¯¾å¿œ\n\n### Phase 5: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ»ãƒ†ã‚¹ãƒˆ\n- CLAUDE.md æ›´æ–°\n- é–‹ç™ºè€…ã‚¬ã‚¤ãƒ‰ä½œæˆ\n- çµ±åˆãƒ†ã‚¹ãƒˆ\n\n## é–¢é€£ Issue\n\n- #135: DBãƒ‘ã‚¹è§£æ±ºãƒ­ã‚¸ãƒƒã‚¯ä¿®æ­£ï¼ˆåŸºç›¤ã¨ã—ã¦æ´»ç”¨ï¼‰\n- #96: npm CLIã‚µãƒãƒ¼ãƒˆï¼ˆCLIæ‹¡å¼µã®åŸºç›¤ï¼‰\n- #125: ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«.envèª­ã¿è¾¼ã¿\n\n## å‚™è€ƒ\n\n- CommandMate è‡ªèº«ãŒ Worktree ç®¡ç†ãƒ„ãƒ¼ãƒ«ã§ã‚ã‚‹ãŸã‚ã€è‡ªèº«ã®é–‹ç™ºã§ Worktree ã‚’æ´»ç”¨ã™ã‚‹ã“ã¨ã¯ Dogfoodingï¼ˆè‡ªå·±å®Ÿè¨¼ï¼‰ã¨ãªã‚‹\n- å®Ÿè£…å¾Œã¯å®Ÿéš›ã®é–‹ç™ºã§ä½¿ç”¨ã—ã€ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’åé›†ã—ã¦æ”¹å–„ã‚’ç¶™ç¶šã™ã‚‹\n\n---\n\n*Generated by Claude Code*","title":"Git Worktree ä¸¦åˆ—é–‹ç™ºç’°å¢ƒã®æ•´å‚™"}
