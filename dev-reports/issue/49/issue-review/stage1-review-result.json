{
  "stage": 1,
  "stage_name": "通常レビュー（1回目）",
  "issue_number": 49,
  "review_date": "2026-01-30",
  "summary": {
    "must_fix_count": 2,
    "should_fix_count": 4,
    "nice_to_have_count": 3
  },
  "findings": {
    "must_fix": [
      {
        "id": "MF-1",
        "category": "整合性",
        "issue": "API設計が既存エンドポイント構造と矛盾している",
        "location": "## 技術仕様 > API設計（案）セクション",
        "recommendation": "既存の `/api/worktrees/:id/files/...` パスパターンに合わせ、`/api/worktrees/:id/files` ベースに統一するか、明確な理由を記載する",
        "evidence": "既存実装: `/api/worktrees/:id/files/[...path]/route.ts` (GETのみ)\nIssue提案: `/api/files` (worktreeId非依存の独立エンドポイント)\n既存APIはworktree単位でスコープされているが、提案ではworktree外のグローバルエンドポイントになっている"
      },
      {
        "id": "MF-2",
        "category": "完全性",
        "issue": "ファイル内容取得APIの設計が欠落している",
        "location": "## 技術仕様 > API設計（案）セクション",
        "recommendation": "`/api/files/content` のGETエンドポイントにworktreeIdとpathのパラメータ仕様を追加する。既存の `/api/worktrees/:id/files/:path` と同様のパラメータ設計を検討",
        "evidence": "Issue提案では `/api/files/content GET` と記載があるが、worktreeIdやpathの指定方法（クエリパラメータ/パスパラメータ）が未定義"
      }
    ],
    "should_fix": [
      {
        "id": "SF-1",
        "category": "明確性",
        "issue": "マークダウンレンダリングに使用するライブラリが未指定",
        "location": "## エディタ・ビューワー セクション",
        "recommendation": "プレビュー機能で使用するライブラリ（react-markdown, remark, marked等）を指定する。既存プロジェクトの依存関係との整合性確認も必要",
        "evidence": "「マークダウンレンダリング表示」と記載があるが、実装方法の指定がない"
      },
      {
        "id": "SF-2",
        "category": "技術的妥当性",
        "issue": "既存FileViewerコンポーネントとの関係性が不明確",
        "location": "## UI配置 セクション",
        "recommendation": "既存の `src/components/worktree/FileViewer.tsx` をモーダルからインラインパネルに改修するのか、新規コンポーネントを作成するのか明確にする",
        "evidence": "既存FileViewerはモーダル形式（Modal使用）。Issueでは「パネルを表示」と記載しており、別のUI構造が想定されている"
      },
      {
        "id": "SF-3",
        "category": "明確性",
        "issue": "ファイル保存のトリガーと保存確認UIが未定義",
        "location": "## 受け入れ条件 セクション",
        "recommendation": "自動保存か手動保存か、保存ボタンの配置、保存失敗時のUI動作を明記する",
        "evidence": "「エディタでmdファイルを編集・保存できる」とあるが、保存のトリガー（Ctrl+S、保存ボタン、自動保存）が未定義"
      },
      {
        "id": "SF-4",
        "category": "完全性",
        "issue": "エラーハンドリング仕様の欠落",
        "location": "## 技術仕様 セクション",
        "recommendation": "ファイル操作失敗時（権限エラー、ファイル競合、ディスク容量不足など）のエラーメッセージとUI対応を追記する",
        "evidence": "Issue #71では詳細なエラーカテゴリとハンドリングが定義されているが、本Issueではエラー処理の記載がない"
      }
    ],
    "nice_to_have": [
      {
        "id": "NTH-1",
        "category": "完全性",
        "issue": "既存FileTreeViewコンポーネントへの変更影響が未記載",
        "location": "Issue本文",
        "recommendation": "`src/components/worktree/FileTreeView.tsx` への変更点（右クリックメニュー追加など）を明記する"
      },
      {
        "id": "NTH-2",
        "category": "技術的妥当性",
        "issue": "md以外のファイル表示ポリシーが曖昧",
        "location": "## 受け入れ条件 セクション",
        "recommendation": "「md以外のファイルは編集不可（表示のみ or 非表示）」の括弧内を決定し、どちらかに確定する"
      },
      {
        "id": "NTH-3",
        "category": "完全性",
        "issue": "キーボードショートカットの仕様がない",
        "location": "## エディタ・ビューワー セクション",
        "recommendation": "Ctrl+S（保存）、Escape（閉じる）、Ctrl+P（プレビュー切り替え）などの基本ショートカットを検討・記載する"
      }
    ]
  },
  "code_references": [
    {
      "file": "/Users/maenokota/share/work/github_kewton/MyCodeBranchDesk/src/components/worktree/FileTreeView.tsx",
      "relevance": "既存のファイルツリー表示コンポーネント。ディレクトリ追加・リネーム・ファイル操作UIの追加対象"
    },
    {
      "file": "/Users/maenokota/share/work/github_kewton/MyCodeBranchDesk/src/components/worktree/FileViewer.tsx",
      "relevance": "既存のファイル内容表示コンポーネント（モーダル形式）。エディタ/プレビュー機能の拡張対象"
    },
    {
      "file": "/Users/maenokota/share/work/github_kewton/MyCodeBranchDesk/src/app/api/worktrees/[id]/files/[...path]/route.ts",
      "relevance": "既存のファイル内容取得API（GETのみ）。PUT/DELETE追加対象"
    },
    {
      "file": "/Users/maenokota/share/work/github_kewton/MyCodeBranchDesk/src/components/worktree/LeftPaneTabSwitcher.tsx",
      "relevance": "Filesタブの切り替えUIコンポーネント"
    }
  ],
  "doc_references": [
    {
      "file": "/Users/maenokota/share/work/github_kewton/MyCodeBranchDesk/docs/architecture.md",
      "relevance": "APIエンドポイント設計の既存パターン参照"
    }
  ]
}
