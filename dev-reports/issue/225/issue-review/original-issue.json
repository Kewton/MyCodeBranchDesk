{"body":"## 概要\n\nAuto-Yesモードを有効化する際に、有効時間を「1時間」「3時間」「8時間」から選択できるようにする。現在は1時間固定（ハードコード）のため、長時間の自動開発セッション時に再度有効化する手間が発生している。\n\n## 背景・課題\n\n- 現在のAuto-Yesモードは有効時間が1時間固定（`AUTO_YES_TIMEOUT_MS = 3600000`）\n- 長時間の自動開発フロー（`/pm-auto-dev`等）では1時間では不足し、タイムアウト後に手動で再有効化が必要\n- 一方、短時間の作業では8時間は長すぎるため、用途に応じた選択肢が必要\n- 安全性の観点から無制限は避け、最大8時間の上限を設ける\n\n## 提案する解決策\n\n既存のAutoYesConfirmDialog（有効化確認ダイアログ）内にラジオボタンを追加し、有効時間を選択できるようにする。選択された時間をAPIに渡し、サーバー側で`expiresAt`を計算する。\n\n### 主要な変更点\n\n- `AutoYesConfirmDialog.tsx`: ラジオボタンUIを追加（1時間/3時間/8時間、デフォルト1時間）\n- `auto-yes-manager.ts`: `setAutoYesEnabled()`にdurationパラメータを追加\n- `auto-yes/route.ts`: POSTリクエストにdurationフィールドを追加・バリデーション\n- `AutoYesToggle.tsx`: カウントダウン表示の動的メッセージ対応\n- `WorktreeDetailRefactored.tsx`: `handleAutoYesToggle`にduration引数を追加\n\n## 実装タスク\n\n- [ ] `AutoYesConfirmDialog.tsx`にラジオボタンUI追加（1h/3h/8h選択）\n- [ ] `onConfirm`コールバックにdurationパラメータ追加\n- [ ] `WorktreeDetailRefactored.tsx`の`handleAutoYesToggle`でdurationを受け取りAPIに渡す\n- [ ] `auto-yes/route.ts`のPOSTハンドラにdurationフィールド追加・バリデーション\n- [ ] `auto-yes-manager.ts`の`setAutoYesEnabled()`にdurationパラメータ追加\n- [ ] `AutoYesToggle.tsx`の表示テキストを選択時間に応じて動的変更\n- [ ] 許可されるduration値のバリデーション定数追加（ホワイトリスト方式）\n- [ ] ユニットテスト追加\n\n## 受入条件\n\n- [ ] Auto-Yes有効化ダイアログに1時間/3時間/8時間のラジオボタンが表示されること\n- [ ] デフォルト選択が1時間であること\n- [ ] 選択した時間に応じてexpiresAtが正しく設定されること\n- [ ] カウントダウンタイマーが選択時間に基づいて動作すること\n- [ ] 許可されていないduration値がAPIで拒否されること\n- [ ] 既存のAuto-Yes動作（自動応答、ポーリング、重複防止）に影響がないこと\n- [ ] モバイル表示でもラジオボタンが正しく表示されること\n\n## 影響範囲\n\n### 変更対象ファイル\n\n| ファイル | 変更内容 |\n|---------|---------|\n| `src/components/worktree/AutoYesConfirmDialog.tsx` | ラジオボタンUI追加、onConfirmにduration引数追加 |\n| `src/components/worktree/AutoYesToggle.tsx` | onToggleシグネチャ変更、表示テキスト動的化 |\n| `src/components/worktree/WorktreeDetailRefactored.tsx` | handleAutoYesToggleにduration引数追加 |\n| `src/lib/auto-yes-manager.ts` | setAutoYesEnabled()にduration引数追加、定数→パラメータ化 |\n| `src/app/api/worktrees/[id]/auto-yes/route.ts` | POSTにdurationフィールド追加・バリデーション |\n\n### 関連コンポーネント（変更不要の見込み）\n\n- `src/lib/auto-yes-resolver.ts` — 応答ロジックは変更なし\n- `src/hooks/useAutoYes.ts` — クライアント側ポーリングは変更なし\n- `src/lib/prompt-detector.ts` — プロンプト検出ロジックは変更なし\n\n### DB変更\n\nなし（Auto-Yes状態はインメモリ管理のため）","title":"auto yesオンに設定時、1時間、3時間、8時間から選択可能にしたい"}
