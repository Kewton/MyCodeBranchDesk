{"body":"## 概要\n\nリポジトリを1つ追加して削除しようとしたが、トップページにリポジトリ名が表示されず削除できない。さらにリポジトリを追加するとフィルタ用のリポジトリが表示されて削除可能になる。ただし、最後の1つは削除できない。\n\n## 根本原因\n\n`WorktreeList.tsx`のリポジトリフィルタUIの表示条件が`repositories.length > 1`となっているため、リポジトリが1つだけの場合、フィルタUI全体（削除ボタン含む）が非表示になる。\n\n### 問題箇所\n\n**ファイル**: `src/components/worktree/WorktreeList.tsx`\n\n**1. リポジトリフィルタの条件（298-337行目）**:\n```tsx\n{/* Repository Filter */}\n{repositories.length > 1 && (  // ← 問題: リポジトリが2つ以上の場合のみ表示\n  <div className=\"flex gap-2 flex-wrap items-center\">\n    {repositories.map((repo) => (\n      <div key={repo.path} className=\"relative group inline-flex items-center\">\n        <Button>{repo.name} ({repo.worktreeCount})</Button>\n        <button onClick={() => handleDeleteRepository(repo.path, repo.name)}>\n          x  {/* ← 削除ボタンがここにしかない */}\n        </button>\n      </div>\n    ))}\n  </div>\n)}\n```\n\n**2. リポジトリヘッダーの条件（450-456行目）**:\n```tsx\n{(repositories.length > 1 || !selectedRepository) && (\n  <div className=\"flex items-center gap-3 pb-2 border-b border-gray-200\">\n    <h3>{repoName}</h3>\n  </div>\n)}\n```\n\n## 再現手順\n\n1. CommandMateで複数のリポジトリを登録する\n2. リポジトリフィルタが表示され、各リポジトリ横に削除ボタン（x）が表示されることを確認\n3. リポジトリを削除して最後の1つだけにする\n4. **結果**: リポジトリフィルタUIが消え、削除ボタンにアクセスできなくなる\n\n## 影響範囲\n\n| ファイル | 役割 | 問題 |\n|---------|------|------|\n| `src/components/worktree/WorktreeList.tsx` | ワークツリーリストUI | リポジトリが1つの場合、フィルタと削除UIが非表示 |\n| `src/app/api/repositories/route.ts` | リポジトリ削除API | 制約なし（API自体は削除可能） |\n| `src/lib/api-client.ts` | APIクライアント | 制約なし |\n\n## 修正案\n\n### 案1: リポジトリが1つでも削除UIを表示（推奨）\n\n```tsx\n// 変更前\n{repositories.length > 1 && (\n\n// 変更後\n{repositories.length >= 1 && (\n```\n\n### 案2: 設定画面やコンテキストメニューに削除機能を追加\n\nリポジトリ管理専用の設定画面を設けて、そこで削除操作を行う。\n\n### 案3: ワークツリーリスト内のリポジトリヘッダーに削除ボタンを追加\n\nリポジトリが1つでもヘッダー部分に削除ボタンを表示する。\n\n## 備考\n\n- APIやDB層には削除を制限する機能がない（UIが非表示なだけ）\n- APIを直接呼び出せば削除は可能（`DELETE /api/repositories`）\n- 回避方法: 新規リポジトリを一時的に追加してから削除する","title":"リポジトリが1つしか存在しない場合削除出来ない"}
