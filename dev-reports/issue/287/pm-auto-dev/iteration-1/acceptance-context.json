{
  "issue_number": 287,
  "feature_summary": "選択肢プロンプトの送信がClaude Codeに認識されない（promptCheck再検証失敗時のフォールバック不備）の修正",
  "acceptance_criteria": [
    "promptCheck再検証が失敗した場合（promptCheck=null）でも、Claude Codeの複数選択肢プロンプト（AskUserQuestion）にカーソルキー方式で正しく応答できること",
    "Yes/Noプロンプトの既存動作に影響がないこと",
    "Codexの既存動作に影響がないこと",
    "既存テスト（tests/unit/api/prompt-response-verification.test.ts）が引き続きパスすること（必要に応じてテスト更新）",
    "promptCheck再検証が失敗するケースのテストが追加されていること",
    "useAutoYes.tsのprompt-response API呼び出しにpromptType/defaultOptionNumberが含まれること（Auto-Yesパスでの同一バグ再発防止）",
    "結合テスト（worktree-detail-integration.test.tsx）でprompt-responseリクエストボディの内容（answer, cliTool, promptType, defaultOptionNumber）が検証されること",
    "promptType/defaultOptionNumberフィールドはオプショナル（?）として設計され、フィールド未送信時の後方互換性が保たれること",
    "defaultOptionNumberがundefinedの場合にフォールバック値1が使用されること（?? 1）。UIが古いバージョンでAPIが新バージョンの場合のテストを含むこと"
  ],
  "test_scenarios": [
    "シナリオ1: promptCheck再検証失敗時のカーソルキー送信 - promptCheck=nullでbody.promptType='multiple_choice'の場合、sendSpecialKeysが正しく呼ばれること",
    "シナリオ2: Yes/Noプロンプトのテキスト送信 - promptCheck=nullでbody.promptType='yes_no'の場合、sendKeysが呼ばれること",
    "シナリオ3: 後方互換性 - promptType/defaultOptionNumberが未送信でもエラーにならないこと",
    "シナリオ4: デフォルト値フォールバック - defaultOptionNumber=undefinedの場合、デフォルト値1が使用されること",
    "シナリオ5: Auto-YesパスでのpromptType送信 - useAutoYes.tsのfetch呼び出しにpromptType/defaultOptionNumberが含まれること",
    "シナリオ6: 結合テストでのリクエストボディ検証 - handlePromptRespondからのAPI呼び出しでリクエストボディが正しく送信されること"
  ],
  "implementation_files": [
    "src/app/api/worktrees/[id]/prompt-response/route.ts",
    "src/components/worktree/WorktreeDetailRefactored.tsx",
    "src/hooks/useAutoYes.ts"
  ]
}
