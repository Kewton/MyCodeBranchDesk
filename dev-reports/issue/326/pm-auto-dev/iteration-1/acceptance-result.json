{
  "status": "passed",
  "test_cases": [
    {
      "scenario": "resolveExtractionStartIndex() is @internal export in src/lib/response-poller.ts",
      "result": "passed",
      "evidence": "Lines 266-302: export function resolveExtractionStartIndex() with @internal JSDoc tag 'Exported for testing only'"
    },
    {
      "scenario": "Location 1 (Claude early prompt detection) uses lines.slice(startIndex)",
      "result": "passed",
      "evidence": "Lines 373-376: resolveExtractionStartIndex() computes startIndex, then lines.slice(startIndex) extracts relevant lines"
    },
    {
      "scenario": "Location 2 (fallback) uses lines.slice(startIndex) and stripAnsi()",
      "result": "passed",
      "evidence": "Lines 516-521: resolveExtractionStartIndex() computes startIndex, lines.slice(startIndex), and stripAnsi(extractedLines.join('\\n')) applied"
    },
    {
      "scenario": "Normal response path uses resolveExtractionStartIndex()",
      "result": "passed",
      "evidence": "Lines 406-408: const startIndex = resolveExtractionStartIndex(lastCapturedLine, totalLines, bufferReset, cliToolId, findRecentUserPromptIndex)"
    },
    {
      "scenario": "tests/unit/lib/resolve-extraction-start-index.test.ts exists and all tests pass",
      "result": "passed",
      "evidence": "12 test cases all passed in 2ms - covers normal case, buffer reset, codex, scroll boundary, negative input, empty buffer, windowSize verification"
    },
    {
      "scenario": "All existing unit tests pass (3647 tests)",
      "result": "passed",
      "evidence": "181 test files, 3647 passed, 7 skipped, 0 failures (Duration: 6.24s)"
    },
    {
      "scenario": "npm run lint completes with 0 errors",
      "result": "passed",
      "evidence": "next lint output: 'No ESLint warnings or errors'"
    }
  ],
  "acceptance_criteria_status": [
    {
      "criterion": "Interactive prompt detection returns only lastCapturedLine onwards (not full buffer)",
      "verified": true
    },
    {
      "criterion": "Previous conversation content does not leak into Assistant messages",
      "verified": true
    },
    {
      "criterion": "Both Location 1 (Claude early prompt detection) and Location 2 (fallback) use resolveExtractionStartIndex + lines.slice(startIndex)",
      "verified": true
    },
    {
      "criterion": "Location 2 response has stripAnsi() applied to prevent ANSI codes in DB",
      "verified": true
    },
    {
      "criterion": "resolveExtractionStartIndex() is @internal export",
      "verified": true
    },
    {
      "criterion": "Existing normal response extraction path behavior unchanged (all 3647 existing tests pass)",
      "verified": true
    },
    {
      "criterion": "New resolve-extraction-start-index test (12 cases) all pass",
      "verified": true
    },
    {
      "criterion": "ESLint errors are 0",
      "verified": true
    },
    {
      "criterion": "TypeScript errors are 0 (confirmed by successful test execution and build)",
      "verified": true
    }
  ],
  "evidence_files": [
    "src/lib/response-poller.ts",
    "tests/unit/lib/resolve-extraction-start-index.test.ts"
  ],
  "message": "All acceptance criteria have been met. resolveExtractionStartIndex() is correctly implemented as a shared helper with @internal export. Both prompt detection paths (Location 1: Claude early detection, Location 2: fallback) use lines.slice(startIndex) with stripAnsi(). The normal response path also uses the shared helper. All 3647 unit tests pass with 0 failures, and ESLint reports 0 errors."
}
