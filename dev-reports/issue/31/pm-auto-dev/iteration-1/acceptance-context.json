{
  "issue_number": 31,
  "feature_summary": "サイドバーのUX改善 - 未読インジケーター修正",
  "acceptance_criteria": [
    "AC1: waitingステータスが黄色で表示される",
    "AC2: ブランチ選択時に青丸（未読インジケーター）が消える",
    "AC3: 別ブランチ作業中にClaudeが回答したら青丸が表示される",
    "AC4: 新規worktreeでは青丸が表示されない",
    "AC5: ビルドが成功する",
    "AC6: 既存のユニットテストがパスする"
  ],
  "test_scenarios": [
    "シナリオ1: BranchStatusIndicatorがwaitingステータスで黄色(bg-yellow-500)を表示することを確認",
    "シナリオ2: hasUnreadロジックがlastAssistantMessageAt > lastViewedAtで正しく計算されることを確認",
    "シナリオ3: lastViewedAtがnullの場合、lastAssistantMessageAtがあればhasUnread=trueになることを確認",
    "シナリオ4: lastAssistantMessageAtがnullの場合、hasUnread=falseになることを確認",
    "シナリオ5: viewed APIが正しく動作することを確認",
    "シナリオ6: TypeScript/ESLintエラーがないことを確認",
    "シナリオ7: ビルドが成功することを確認"
  ],
  "implemented_changes": {
    "g1_waiting_color": "SF1で実装済み - src/config/status-colors.ts",
    "g2_hasunread_logic": "src/types/sidebar.ts - calculateHasUnread関数",
    "g3_db_schema": "src/lib/db-migrations.ts - version 11",
    "g4_viewed_api": "src/app/api/worktrees/[id]/viewed/route.ts",
    "g5_lastAssistantMessageAt": "src/lib/db.ts - getWorktrees, getWorktreeById",
    "g6_frontend_integration": "src/contexts/WorktreeSelectionContext.tsx"
  }
}
