{
  "issue_number": 31,
  "issue_title": "サイドバーのUX改善",
  "acceptance_criteria": [
    "AC1: waitingステータスが黄色で表示される（完了済み - SF1で実装）",
    "AC2: ブランチ選択時に青丸（未読インジケーター）が消える",
    "AC3: 別ブランチ作業中にClaudeが回答したら青丸が表示される",
    "AC4: 新規worktreeでは青丸が表示されない",
    "AC5: ビルドが成功する",
    "AC6: 既存のユニットテストがパスする"
  ],
  "implementation_tasks": [
    "G3: DBスキーマにlast_viewed_atカラムを追加（マイグレーションversion 11）",
    "G4: 既読更新API追加（PATCH /api/worktrees/:id/viewed）",
    "G5: lastAssistantMessageAt取得をAPIレスポンスに追加（サブクエリ方式）",
    "G2: hasUnreadロジック修正（lastAssistantMessageAt > lastViewedAt）",
    "G6: フロントエンド既読連携（ブランチ選択時にviewed APIを呼び出し）"
  ],
  "target_coverage": 80,
  "design_document": "dev-reports/design/issue-31-gap-analysis.md",
  "notes": [
    "G1（waitingの色変更）は既にSF1で実装済み",
    "MF1（API存在確認）とMF2（インデックス追加）は設計ドキュメントに反映済み",
    "SF2（ログ追加）は設計ドキュメントに反映済み"
  ]
}
