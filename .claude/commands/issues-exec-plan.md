---
model: opus
description: "複数Issueの並列作業可否を分析し、実行計画をまとめるエピックIssueを作成"
---

# Issues実行計画コマンド

## 概要
複数のIssue番号を指定し、並列作業の可否を分析・実行順序を整理した上で、進捗管理用のエピックIssueをGitHubに作成します。

## 使用方法
```bash
/issues-exec-plan [Issue番号1] [Issue番号2] [Issue番号3] ...
```

**例**:
```bash
/issues-exec-plan 187 188 191 193
/issues-exec-plan 200 201
```

**引数**:
- `[Issue番号...]`: 対象Issue番号（2つ以上、スペース区切り）

## 実行内容

あなたはプロジェクトマネージャーです。複数Issueの並列作業可否を分析し、実行計画を立案してください。

### パラメータ

- **issue_numbers**: 対象Issue番号のリスト（必須、2つ以上）

---

## 実行フェーズ

### Phase 1: Issue情報収集

各Issueの情報をGitHubから取得します。

```bash
# 各Issueの情報を取得
for ISSUE_NO in {issue_numbers}; do
  gh issue view $ISSUE_NO --json number,title,body,labels,state
done
```

**収集する情報**:
- Issue番号・タイトル
- Issue本文（要件、受入基準）
- ラベル（bug, feature, etc.）
- ステータス（open/closed）

**バリデーション**:
- 各Issueが存在すること
- 各Issueがopenであること（closedの場合は警告を出して除外）

---

### Phase 1.5: Issue情報充足チェック・補完

各Issueの本文を分析し、並列作業分析に必要な情報が十分かを判定します。
情報が不足しているIssueには `/issue-enhance` を実行して補完します。

#### 1.5-1. 充足判定基準

各Issueの本文に以下の情報が含まれているかチェックする：

| チェック項目 | 判定方法 | 分析への影響 |
|-------------|---------|-------------|
| **概要** | Issue本文に概要・説明があるか | 共通テーマの判定に必要 |
| **変更対象の手がかり** | ファイル名、コンポーネント名、関数名等の具体的な技術情報があるか | 影響ファイル分析・競合判定に必須 |
| **受入条件/完了条件** | チェックリストや具体的な条件があるか | 進捗チェックリスト生成に必要 |

#### 1.5-2. 不足判定ルール

以下のいずれかに該当するIssueは「情報不足」と判定：

- **本文が空またはタイトルのみ**: 分析不可能
- **変更対象の手がかりがない**: 概要のみで技術的な記述（ファイル名、モジュール名、関数名、コンポーネント名）が一切ない
- **Issue本文が3行以下**: 情報量が明らかに不足

#### 1.5-3. issue-enhance実行

情報不足と判定されたIssueに対して順番に `/issue-enhance` を実行：

```
# 不足Issueが複数ある場合、1つずつ順番に実行
for ISSUE_NO in {insufficient_issues}; do
  /issue-enhance $ISSUE_NO
done
```

**注意事項**:
- `/issue-enhance` はユーザーへの対話的質問を含むため、1 Issueずつ順番に実行する
- 補完完了後、Issue情報を再取得して次のPhaseに進む
- ユーザーが `/issue-enhance` 内でキャンセルした場合は、そのIssueを現状のまま続行する

#### 1.5-4. 充足Issueのスキップ

十分な情報があるIssueは補完をスキップし、ログに記録：

```
📋 Issue情報充足チェック:
  ✅ #187: 情報十分（概要・変更対象・受入条件あり）
  ✅ #191: 情報十分（概要・変更対象・受入条件あり）
  ⚠️ #193: 情報不足 → /issue-enhance 実行
  ⚠️ #200: 情報不足 → /issue-enhance 実行
```

---

### Phase 2: 影響ファイル分析

各Issueが変更する可能性のあるファイルを特定します。

#### 2-1. Issue本文からの変更対象ファイル抽出

各Issueの本文・受入基準・設計書（存在する場合）から変更対象ファイルを特定：

```bash
# 設計書が存在する場合は参照
ls dev-reports/design/issue-{issue_number}-*-design-policy.md 2>/dev/null
```

#### 2-2. コードベース調査

Issue本文に記載のモジュール名・関数名をコードベースで検索し、影響範囲を特定：

- 変更対象ファイルのリストアップ
- 変更対象の関数・クラスの特定
- 共有される依存関係の把握

---

### Phase 3: 競合分析・並列可否判定

#### 3-1. ファイル競合マトリクス作成

各Issueが変更するファイルの一覧をマトリクスにまとめ、競合箇所を特定：

| ファイル | Issue A | Issue B | Issue C |
|---------|---------|---------|---------|
| file1.ts | edit | | edit |
| file2.ts | | edit | |

#### 3-2. 競合判定ルール

| 競合レベル | 条件 | 判定 |
|-----------|------|------|
| **なし** | 変更ファイルが完全に独立 | 並列可能 |
| **軽微** | 同一ファイルだが変更箇所が異なる関数/セクション | 並列可能（注意付き） |
| **中程度** | 同一ファイルの同一関数を変更 | 順序依存（先行Issue指定） |
| **重大** | 一方の変更が他方の前提条件となる | 厳密な順序依存 |

#### 3-3. 優先度判定

以下の基準で実行優先度を決定：

1. **依存関係**: 他Issueの前提となるIssueを先に
2. **ラベル優先度**: P0 > P1 > P2
3. **影響範囲**: 共有コンポーネントの修正を先に（後続Issueの基盤となる）
4. **サイズ**: 小さいIssueを先に（早期完了で並列可能範囲を広げる）

---

### Phase 4: 実行計画策定

#### 4-1. Phase分けとグループ化

分析結果に基づき、実行Phaseを策定：

```
Phase 1（並列実行可能）:
  ├─ #XXX: ...（独立）
  ├─ #YYY: ...（独立）
  └─ #ZZZ: ...（独立）

Phase 2（Phase 1完了後）:
  └─ #WWW: ...（#XXXに依存）
```

#### 4-2. 実行計画の最適化

- 並列実行可能なIssueは同一Phaseにまとめる
- クリティカルパスを特定し、ボトルネックを明示
- 各Phaseの完了条件を明確化

---

### Phase 5: エピックIssue作成

#### 5-1. Issue本文の構成

以下の構成でエピックIssueを作成：

```markdown
## 概要

{対象Issueの共通テーマ}に関する{N}つのIssueをまとめて管理するエピックIssueです。

## 対象Issue一覧

| Issue | タイトル | 優先度 | ステータス |
|-------|---------|--------|-----------|
| #{issue_no} | {title} | {priority} | 🔴 未着手 |
...

## 依存関係・実行順序

### 並列作業の可否

```
グループA（順序依存）:  #XXX → #YYY
  ├─ #XXX: {変更内容の要約}
  └─ #YYY: {変更内容の要約}
  ※ {競合理由}

グループB（独立・並列可能）: #ZZZ
  └─ {変更内容の要約}
```

### 推奨実行計画

```
Phase 1（並列実行可能）:
  ├─ #XXX ...
  └─ #ZZZ ...

Phase 2（#XXX完了後）:
  └─ #YYY ...
```

## ファイル競合マトリクス

| ファイル | #XXX | #YYY | #ZZZ |
|---------|------|------|------|
| file.ts | ✏️ | ✏️ | |
...

**競合箇所**: {競合の説明}

## 進捗チェックリスト

- [ ] #XXX {タイトル}
  - [ ] 設計レビュー
  - [ ] 実装・テスト
  - [ ] PR作成・マージ
...

## 完了条件

- [ ] {N}つのIssueがすべてクローズされていること
- [ ] 全テスト（unit, integration）がパスすること
- [ ] `npm run lint` と `npx tsc --noEmit` がパスすること
```

#### 5-2. Issue作成

```bash
gh issue create \
  --title "epic: {共通テーマ}（{Issue番号リスト}）" \
  --body "$(cat /tmp/epic-issue-body.md)" \
  --label "epic"
```

#### 5-3. 結果報告

```
✅ エピックIssue作成完了！

📋 エピックIssue:
  #{epic_issue_no}: {タイトル}
  URL: https://github.com/Kewton/CommandMate/issues/{epic_issue_no}

📊 分析結果サマリー:
  対象Issue数:     {N}
  並列実行可能:    {並列グループ数}組
  順序依存:        {依存ペア数}組
  推奨Phase数:     {Phase数}

🔧 推奨実行順序:
  Phase 1: {Issue番号リスト}（並列可能）
  Phase 2: {Issue番号リスト}（Phase 1完了後）
  ...

🎯 次のステップ:
  Phase 1のIssueから着手してください。
  各Issueの開発は /pm-auto-issue2dev で自動実行可能です。
```

---

## エラーハンドリング

| エラー | 条件 | 対処 |
|--------|------|------|
| **Issue不在** | 指定されたIssue番号が存在しない | エラーメッセージを表示し、該当Issueを除外して続行 |
| **全Issueクローズ済み** | 全てのIssueがclosed | エラーメッセージを表示し終了 |
| **Issue数不足** | 有効なIssueが1つ以下 | エラーメッセージを表示し終了 |
| **GitHub CLI未認証** | `gh auth status` が失敗 | 認証手順を案内 |
| **Issue作成失敗** | `gh issue create` がエラー | エラー詳細を表示 |

---

## 注意事項

### 前提条件
- GitHub CLIがインストール済み
- GitHub認証が完了済み
- 対象Issueが2つ以上存在すること

### 分析の精度
- Issue本文や設計書に変更対象ファイルの情報がない場合、コードベース調査に基づく推定となります
- 実際の実装時に予期しない競合が発生する可能性があります
- 設計書（design-policy）が存在するIssueほど精度が高くなります

---

## 関連コマンド

- `/issue-enhance`: Issue内容の対話的補完（Phase 1.5で自動実行）
- `/pm-auto-issue2dev`: Issueレビューから実装完了まで完全自動化
- `/pm-auto-design2dev`: 設計レビューから実装完了まで完全自動化
- `/worktree-setup`: Worktree環境の自動構築
- `/work-plan`: 作業計画立案
- `/create-pr`: PR作成
