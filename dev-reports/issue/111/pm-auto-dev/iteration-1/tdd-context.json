{
  "issue_number": 111,
  "title": "現在の作業ブランチを可視化して欲しい",
  "acceptance_criteria": [
    "ワークツリー詳細画面のヘッダーに現在のgitブランチ名が表示される",
    "セッション開始時のブランチと現在のブランチが異なる場合、視覚的に警告が表示される",
    "モバイル表示でもブランチ情報が確認できる",
    "ブランチ情報は定期的に更新される（アクティブ時: 2秒、アイドル時: 5秒）",
    "パフォーマンスへの影響が最小限である（git コマンド実行のオーバーヘッド）",
    "DBマイグレーション（Migration #15）が正常に適用される",
    "detached HEAD状態でも警告が不適切に表示されない",
    "gitコマンドタイムアウト時もアプリが正常に動作する",
    "既存テストが全てパスする（後方互換性維持）"
  ],
  "implementation_tasks": [
    "Task 1: DBマイグレーション - Migration #15 追加（worktrees テーブルに initial_branch カラム追加、CURRENT_SCHEMA_VERSION を 15 に更新）",
    "Task 2: 型定義 - GitStatus interface 追加、Worktree interface に gitStatus?: GitStatus フィールド追加（オプショナル）",
    "Task 3: バックエンド - git-utils.ts 作成、getGitStatus関数実装（execFile使用、1秒タイムアウト）",
    "Task 4: DB操作関数 - saveInitialBranch, getInitialBranch関数追加（src/lib/db.ts）",
    "Task 5: send/route.ts - startSession() 呼び出し後に initial_branch を保存する処理追加",
    "Task 6: API拡張 - GET /api/worktrees/:id にgitStatusフィールドを追加",
    "Task 7: UIコンポーネント - BranchMismatchAlert.tsx 作成",
    "Task 8: 統合 - WorktreeDetailRefactored.tsx と MobileHeader.tsx へのブランチ情報表示統合"
  ],
  "target_coverage": 80,
  "design_doc_path": "dev-reports/design/issue-111-branch-visualization-design-policy.md",
  "work_plan_path": "dev-reports/issue/111/work-plan.md"
}
