{
  "issue_number": 28,
  "issue_title": "履歴表示改善",
  "problem_summary": "Assistantからの履歴表示が一部切れているケースが頻発している",
  "root_causes": [
    "ページネーション未使用 - デフォルト50件のみ取得",
    "スクロール管理の問題 - sticky ヘッダーとの干渉",
    "CSSオーバーフロー制約 - アシスタント応答に max-w 制約なし"
  ],
  "acceptance_criteria": [
    "長いテキストが切れずに表示されること",
    "50件以上のメッセージがある場合、スクロールで追加読み込みできること",
    "スクロール位置が正しく復元されること",
    "Safari でも正常に表示されること",
    "単体テストカバレッジ80%以上"
  ],
  "implementation_phases": [
    {
      "phase": 1,
      "name": "CSS修正",
      "tasks": [
        {
          "id": "1.1",
          "description": "アシスタント応答のCSS制約追加",
          "file": "src/components/worktree/ConversationPairCard.tsx",
          "details": "max-w-full, overflow-x-hidden, word-break:break-word を追加"
        },
        {
          "id": "1.2",
          "description": "word-break統一（Safari対応）",
          "file": "src/components/worktree/ConversationPairCard.tsx",
          "details": "overflow-wrap: anywhere ではなく word-break: break-word を使用"
        }
      ]
    },
    {
      "phase": 2,
      "name": "スクロール管理改善",
      "tasks": [
        {
          "id": "2.1",
          "description": "sticky ヘッダー高さの定数化",
          "file": "src/components/worktree/HistoryPane.tsx"
        },
        {
          "id": "2.2",
          "description": "useScrollRestoration フック作成",
          "file": "src/hooks/useScrollRestoration.ts",
          "new_file": true
        },
        {
          "id": "2.3",
          "description": "HistoryPane へのフック統合",
          "file": "src/components/worktree/HistoryPane.tsx"
        }
      ]
    },
    {
      "phase": 3,
      "name": "ページネーション実装",
      "tasks": [
        {
          "id": "3.1",
          "description": "InfiniteMessagesError 型定義",
          "file": "src/types/infinite-messages.ts",
          "new_file": true
        },
        {
          "id": "3.2",
          "description": "useScrollObserver フック作成",
          "file": "src/hooks/useScrollObserver.ts",
          "new_file": true
        },
        {
          "id": "3.3",
          "description": "useInfiniteMessages フック作成",
          "file": "src/hooks/useInfiniteMessages.ts",
          "new_file": true
        },
        {
          "id": "3.4",
          "description": "HistoryPane のページネーション対応",
          "file": "src/components/worktree/HistoryPane.tsx"
        },
        {
          "id": "3.5",
          "description": "WorktreeDetailRefactored 統合",
          "file": "src/components/worktree/WorktreeDetailRefactored.tsx"
        }
      ]
    }
  ],
  "test_files": [
    "tests/unit/hooks/useScrollRestoration.test.ts",
    "tests/unit/hooks/useScrollObserver.test.ts",
    "tests/unit/hooks/useInfiniteMessages.test.ts",
    "tests/integration/history-display.test.tsx",
    "tests/integration/conversation-pair-card.test.tsx"
  ],
  "target_coverage": 80,
  "design_doc": "dev-reports/design/issue28-history-display-design-policy.md",
  "work_plan": "dev-reports/issue/28/work-plan.md"
}
