{
  "issue_number": 212,
  "feature_summary": "fix: 複数行メッセージ送信時の[Pasted text]表示を検知してEnter自動送信",
  "acceptance_criteria": [
    "3-10行の複数行メッセージが正常に送信・処理されること",
    "50行以上の複数行メッセージが正常に送信・処理されること",
    "単一行メッセージの既存動作に影響がないこと",
    "[Pasted text] 検知時にEnterが自動送信されること",
    "特殊文字を含むメッセージが正しく処理されること",
    "PASTED_TEXT_PATTERN のユニットテストが存在し、既知のClaude CLI出力フォーマットに対して正しく検知すること",
    "Pasted text検知後のEnter再送がリトライ上限（MAX_PASTED_TEXT_RETRIES=3）回に達しても解消しない場合、警告ログが出力されること",
    "codex.ts の sendMessage() に対してもPasted text検知ロジックが適用されていること（sendKeysパス・execAsyncパス両方）",
    "codex.ts の sendMessage() において、検知の capturePane() 呼び出しが execAsync(C-m) によるEnter送信後に行われることがテストで検証されていること",
    "[Pasted text #N +XX lines] の表示がレスポンスメッセージに含まれないこと（cleanClaudeResponse + extractResponse 両方で除外）",
    "codex.test.ts に sendMessage() のモックベースのユニットテスト基盤が構築されていること",
    "既存の統合テスト（api-send-cli-tool.test.ts）がPasted text検知ロジック追加後も正常にパスすること",
    "単体テストカバレッジ80%以上"
  ],
  "test_scenarios": [
    "シナリオ1: 単一行メッセージ送信 - ガード条件により検知スキップ、+0ms遅延、既存動作維持",
    "シナリオ2: 3-10行の複数行メッセージ送信 - [Pasted text]検知、Enter自動送信、リトライ最大3回",
    "シナリオ3: 50行以上の大規模メッセージ送信 - 同様の検知・再送ロジックが動作",
    "シナリオ4: 特殊文字（ANSI codes）を含むメッセージ - stripAnsi処理後にパターン検知",
    "シナリオ5: リトライ上限到達 - 警告ログ出力、エラーをスローしない",
    "シナリオ6: codex.ts の sendMessage() - execAsync(C-m)送信後に検知、順序検証",
    "シナリオ7: レスポンスフィルタリング - cleanClaudeResponse と extractResponse で [Pasted text] 除外",
    "シナリオ8: 回帰テスト - 既存の統合テストがPasted text検知ロジック追加後も正常動作"
  ],
  "tdd_result_path": "dev-reports/issue/212/pm-auto-dev/iteration-1/tdd-result.json",
  "implementation_summary": {
    "new_files": [
      "src/lib/pasted-text-helper.ts",
      "tests/unit/lib/pasted-text-helper.test.ts",
      "tests/unit/lib/response-poller.test.ts",
      "tests/unit/cli-tools/codex-pasted-text.test.ts"
    ],
    "modified_files": [
      "src/lib/cli-patterns.ts",
      "src/lib/claude-session.ts",
      "src/lib/cli-tools/codex.ts",
      "src/lib/response-poller.ts",
      "tests/unit/lib/cli-patterns.test.ts",
      "tests/unit/lib/claude-session.test.ts"
    ],
    "total_tests": 24,
    "coverage": 100.0
  }
}
