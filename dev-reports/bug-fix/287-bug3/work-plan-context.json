{
  "bug_id": "287-bug3",
  "bug_description": "prompt-detector.ts の detectMultipleChoicePrompt() Pass 2 逆方向スキャンに ❯ バリアを追加して、過去の会話テキストの番号付きリスト誤検出を防止する",
  "selected_actions": [
    {
      "action_id": "1",
      "title": "Pass 2 逆方向スキャンに ❯ バリアを追加",
      "description": "collectedOptions.length === 0 かつ行が ❯ (U+276F) で始まる（DEFAULT_OPTION_PATTERN に非マッチ）場合、noPromptResult を返してスキャンを停止。ユーザー入力プロンプトやアイドルプロンプトをバリアとして機能させ、それ以前の過去テキストへのスキャンを防止する。",
      "files_to_modify": [
        "src/lib/prompt-detector.ts"
      ]
    }
  ],
  "deliverables": [
    "src/lib/prompt-detector.ts（バリアロジック追加）",
    "tests/unit/lib/prompt-detector.test.ts（バリアテストケース追加）"
  ],
  "definition_of_done": [
    "過去の会話テキスト内の番号付きリストが multiple_choice プロンプトとして誤検出されないこと",
    "アクティブな multiple_choice プロンプト（❯ 1. Yes 等）は引き続き正常に検出されること",
    "requireDefaultIndicator=false (Claude) と true (その他) の両方で動作すること",
    "既存テストが全てパスすること",
    "ESLint/TypeScript エラーが 0 件であること"
  ]
}
