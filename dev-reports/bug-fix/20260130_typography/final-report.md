# バグ修正完了報告: マークダウンプレビュー表示問題

## 概要

| 項目 | 内容 |
|------|------|
| **Bug ID** | 20260130_typography |
| **報告日** | 2026-01-30 |
| **ステータス** | ✅ 修正完了 |

## 修正内容

### 問題1: prose クラスが無効（Typography プラグイン未インストール）

**症状**: コードブロック、番号付きリスト、見出し等のスタイルが欠落

**原因**: `@tailwindcss/typography` プラグインが未インストール

**修正**:
1. `npm install -D @tailwindcss/typography`
2. `tailwind.config.js` の plugins に追加

```javascript
plugins: [
  require('@tailwindcss/typography'),
],
```

---

### 問題2: シンタックスハイライトが無効（CSS未インポート）

**症状**: コードブロックで言語を指定しても色が付かない

**原因**: `rehype-highlight` は使用しているが、highlight.js のテーマ CSS がインポートされていない

**修正**:
`src/components/worktree/MarkdownEditor.tsx` に CSS インポートを追加

```typescript
import rehypeHighlight from 'rehype-highlight';
import 'highlight.js/styles/github-dark.css';  // ← 追加（ダークテーマ）
```

---

### 問題3: コードブロックの背景色・枠線の競合

**症状**: コードブロックの背景色が変わらず、枠線が太字で見にくい

**原因**: Tailwind Typography と highlight.js のスタイルが競合

**修正**:
1. highlight.js テーマを `github-dark` に変更（ダーク背景）
2. `globals.css` でスタイル調整を追加

```css
/* Markdown code block styles - Fix Typography/highlight.js conflict */
.prose pre {
  @apply bg-transparent p-0 border-0;
}

.prose pre code.hljs {
  @apply rounded-md;
  padding: 1rem;
}

/* Inline code styling (not in pre blocks) */
.prose :not(pre) > code {
  @apply bg-gray-100 text-gray-800 px-1.5 py-0.5 rounded text-sm font-mono;
}

.prose :not(pre) > code::before,
.prose :not(pre) > code::after {
  content: none;
}
```

---

## 変更ファイル一覧

| ファイル | 変更内容 |
|----------|----------|
| `package.json` | `@tailwindcss/typography` を devDependencies に追加 |
| `tailwind.config.js` | plugins に Typography プラグインを追加 |
| `src/components/worktree/MarkdownEditor.tsx` | highlight.js テーマ CSS をインポート（github-dark） |
| `src/app/globals.css` | コードブロックのスタイル調整を追加 |

## テスト結果

| テスト種別 | 結果 |
|-----------|------|
| ビルド | ✅ PASS |
| 単体テスト | ✅ PASS (1899 tests) |
| TypeScript | ✅ PASS |
| ESLint | ✅ PASS |

## 動作確認

サーバー起動中: http://localhost:3000

### 確認項目
- [x] コードブロックがスタイリングされる
- [x] 番号付きリストが正しく表示される
- [x] 見出し、引用、テーブルが正しく表示される
- [x] シンタックスハイライト（Python, JavaScript等）が機能する

## 今後の対応

mermaid ダイアグラム対応は別 Issue として登録済み:
- **Issue #100**: [feat: マークダウンプレビューでmermaidダイアグラムを描画できるようにする](https://github.com/Kewton/CommandMate/issues/100)

---

*Generated by PM Bug Fix Agent - 2026-01-30*
