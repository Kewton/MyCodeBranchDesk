{
  "issue_number": 191,
  "acceptance_criteria": [
    "バッファに過去のthinkingサマリー行が残存していても、プロンプトが正常に検出される",
    "実際のthinking状態（Claude CLIが処理中）ではプロンプト検出がスキップされる（Issue #161の防御は維持）",
    "detectThinking()の検索範囲がstatus-detector.tsの実装方針（末尾N行のウィンドウイング）と一貫していること",
    "回帰テスト: 5000行バッファ内の先頭100行にthinkingサマリー行が存在し、末尾10行にプロンプトがある場合にプロンプトが正常検出される",
    "回帰テスト: thinkingパターンが末尾50行以内に存在する場合にプロンプト検出が正しくスキップされる",
    "既存のAuto-Yesテストがすべてパスする",
    "npm run test:unit が通ること",
    "npm run lint と npx tsc --noEmit が通ること"
  ],
  "implementation_tasks": [
    "Task 1.1: auto-yes-manager.ts に export const THINKING_CHECK_LINE_COUNT = 50 定数追加（SF-001対応コメント、SEC-C02安全性コメント含む）",
    "Task 1.2: pollAutoYes() L284 の detectThinking() 呼び出しにウィンドウイング適用（cleanOutput.split('\\n').slice(-THINKING_CHECK_LINE_COUNT).join('\\n')）",
    "Task 2.1: テスト1 - 5000行バッファ + stale thinking + prompt でsendKeysが呼ばれること",
    "Task 2.2: テスト2 - 末尾50行以内にthinkingパターンがある場合はsendKeysが呼ばれないこと",
    "Task 2.3: テスト3 - THINKING_CHECK_LINE_COUNT と prompt-detector.ts のウィンドウサイズ一致検証（SF-001）"
  ],
  "target_coverage": 80,
  "design_doc_path": "dev-reports/design/issue-191-auto-yes-thinking-windowing-design-policy.md",
  "work_plan_path": "dev-reports/issue/191/work-plan.md"
}
