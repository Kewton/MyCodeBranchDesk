{
  "issue_number": 163,
  "feature_summary": "長いメッセージ（複数行テキスト）の場合、メッセージを送信してもClaude側で処理が開始されない問題の修正",
  "acceptance_criteria": [
    "50行以上の複数行メッセージがClaude CLIに正常に送信されること",
    "改行を含むテキストが正しく送信されること（改行が保持される）",
    "特殊文字（$, \", \\, `）を含むメッセージが正しくエスケープされること",
    "コマンドインジェクション試行テストをパスすること（例: $(whoami), `id`）",
    "バッファ名に不正な文字が含まれる場合、サニタイズされること",
    "NULバイトを含むテキストが適切に処理されること（除去後に送信）",
    "バッファ作成失敗時に適切なエラーメッセージが出力されること",
    "ペースト失敗時にバッファがクリーンアップされること（リーク防止）",
    "Claude CLIでsendTextViaBuffer()が使用されること（sendKeys()ではなく）",
    "Codex CLIでsendTextViaBuffer()が使用されること（sendKeys()+execAsyncではなく）",
    "Gemini CLIの既存動作に影響がないこと",
    "ESLintエラー0件",
    "TypeScript型エラー0件",
    "全ユニットテストパス",
    "npm run build 成功",
    "npm run build:server 成功"
  ],
  "test_scenarios": [
    "シナリオ1: sendTextViaBuffer()が正しく実装され、tmux load-buffer/paste-buffer方式でテキストを送信する",
    "シナリオ2: エスケープ処理が正しい順序（\\→$→\"→`）で適用される",
    "シナリオ3: バッファ名がcm-プレフィックス付きでサニタイズされる",
    "シナリオ4: NULバイトが除去される",
    "シナリオ5: エラー時にバッファクリーンアップが実行される",
    "シナリオ6: sendMessageToClaude()がsendTextViaBuffer()を1回呼び出す（sendKeys 2回ではなく）",
    "シナリオ7: Codex sendMessage()がsendTextViaBuffer()を1回呼び出す（sendKeys+execAsyncではなく）",
    "シナリオ8: codex.tsのsendMessage()内にexecAsync tmux直接呼び出しが存在しない",
    "シナリオ9: 全CIチェック（lint, tsc, test, build, build:server）がパスする"
  ],
  "changed_files": [
    "src/lib/tmux.ts",
    "src/lib/claude-session.ts",
    "src/lib/cli-tools/codex.ts",
    "tests/unit/lib/tmux.test.ts",
    "tests/unit/lib/claude-session.test.ts",
    "tests/unit/cli-tools/codex.test.ts"
  ]
}
