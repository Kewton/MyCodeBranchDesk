{
  "issue_number": 162,
  "stage": 2,
  "stage_name": "整合性レビュー",
  "status": "success",
  "design_policy_updated": true,
  "reflected_items": {
    "must_fix": [
      {
        "id": "MF-S2-001",
        "item": "ContextMenu labels are hardcoded English but design assumes i18n via worktree.json",
        "section_updated": "3-1-4, 5-1, 8, 13",
        "status": "reflected",
        "changes": "Updated ContextMenu section to specify hardcoded English label for 'Move'. Removed 'move' key from worktree.json i18n section. Added design decision to Section 8. Updated implementation checklist."
      },
      {
        "id": "MF-S2-002",
        "item": "FileTreeView.tsx does not use i18n - adding formatRelativeTime with locale parameter is pattern-inconsistent",
        "section_updated": "3-2-3, 8, 13",
        "status": "reflected",
        "changes": "Added explicit locale acquisition strategy using useLocale() from next-intl and getDateFnsLocale() conversion. Added code example. Updated implementation checklist."
      }
    ],
    "should_fix": [
      {
        "id": "SF-S2-001",
        "item": "Move error messages should follow existing error.json pattern, not worktree.json",
        "section_updated": "5-1, 9, 13",
        "status": "reflected",
        "changes": "Moved failedToMove to error.json fileOps section. Removed moveFailed from worktree.json. Added error.json files to implementation file list. Updated i18n checklist."
      },
      {
        "id": "SF-S2-002",
        "item": "PATCH handler validation message should list all supported actions",
        "section_updated": "3-1-2, 13",
        "status": "reflected",
        "changes": "Added explicit note about updating error message to 'Supported: \"rename\", \"move\"'. Added checklist item."
      },
      {
        "id": "SF-S2-003",
        "item": "validateFileOperation() should handle empty path consistently with isPathSafe()",
        "section_updated": "3-1-0, 13",
        "status": "reflected",
        "changes": "Added clarification about validation responsibility split: validateFileOperation() handles source only, moveFileOrDirectory() handles destination. Updated validation table and added checklist item."
      },
      {
        "id": "SF-S2-004",
        "item": "FileViewer copy button needs locale for Toast messages if i18n is applied",
        "section_updated": "3-3-1, 5-1, 8, 13",
        "status": "reflected",
        "changes": "Clarified icon-only feedback approach (no Toast, no i18n needed). Removed copySuccess/copyFailed/copyContent from worktree.json. Updated design decision table and checklist."
      },
      {
        "id": "SF-S2-005",
        "item": "Move destination should also check isProtectedDirectory() for the destination directory itself",
        "section_updated": "3-1-0, 4-1, 13",
        "status": "reflected",
        "changes": "Updated security table and validation responsibility table to explicitly state both destination directory and final path (destination + filename) must be checked. Added checklist item."
      }
    ],
    "consider": [
      {
        "id": "CO-S2-001",
        "item": "Existing file operation handlers use window.prompt/alert, but design uses MoveDialog and Toast",
        "status": "noted",
        "notes": "Already addressed by existing Phase 1/2 migration strategy in Section 3-1-6. No additional changes needed."
      },
      {
        "id": "CO-S2-002",
        "item": "PATCH move action uses 'destination' field while rename uses 'newName'",
        "status": "noted",
        "notes": "Semantically appropriate naming. No change needed."
      },
      {
        "id": "CO-S2-003",
        "item": "formatRelativeTime() in date-utils.ts vs inline formatDistanceToNow in WorktreeCard.tsx",
        "status": "noted",
        "notes": "Already documented as future DRY improvement in Section 3-2-4 design rationale."
      },
      {
        "id": "CO-S2-004",
        "item": "Design i18n key 'moveCancel' in worktree.json duplicates existing common.json 'cancel' key",
        "section_updated": "5-1, 8, 13",
        "status": "reflected",
        "notes": "Removed fileTree.moveCancel from worktree.json. MoveDialog will use tCommon('cancel'). Added to design decisions and checklist."
      }
    ]
  },
  "skipped": [],
  "design_doc_path": "dev-reports/design/issue-162-file-enhancement-design-policy.md",
  "sections_updated": [
    "3-1-0 (バリデーション責務明確化: SF-S2-003, SF-S2-005)",
    "3-1-2 (不明アクションエラーメッセージ: SF-S2-002)",
    "3-1-4 (ContextMenuラベルハードコード方針: MF-S2-001)",
    "3-2-3 (useLocale()ロケール取得方針: MF-S2-002)",
    "3-3-1 (コピーフィードバック方式明確化: SF-S2-004)",
    "4-1 (isProtectedDirectory()チェック詳細化: SF-S2-005)",
    "5-1 (i18nキー配置先整理: MF-S2-001, SF-S2-001, SF-S2-004, CO-S2-004)",
    "8 (設計上の決定事項追加)",
    "9 (実装対象ファイル一覧にerror.json追加)",
    "11 (レビュー履歴にStage 2追加)",
    "12 (Stage 2レビュー指摘事項サマリー追加)",
    "13 (実装チェックリスト更新)"
  ],
  "timestamp": "2026-02-15T12:30:00Z"
}
