{
  "issue_number": 256,
  "refactor_targets": [
    "src/lib/prompt-detector.ts",
    "tests/unit/prompt-detector.test.ts",
    "tests/integration/issue-256-acceptance.test.ts"
  ],
  "quality_metrics": {
    "before_coverage": 98.15,
    "unit_tests_total": 161,
    "unit_tests_passed": 161,
    "full_suite_total": 3103,
    "full_suite_passed": 3103,
    "eslint_errors": 0,
    "typescript_errors": 0
  },
  "improvement_goals": [
    "カバレッジ98.15%の維持（目標80%を大幅に超過済み）",
    "コードの可読性向上（特にisQuestionLikeLine()の4パターン、findQuestionLineInRange()の上方走査ロジック）",
    "JSDocドキュメントの充実（設計根拠、使用例、注意事項の明記）",
    "テストコードの保守性向上（テストケースのグルーピング、説明の充実）",
    "重複コードの削除（DRY原則の徹底）",
    "SOLID原則の遵守確認（特にSRP: MF-001対応が適切か）",
    "パフォーマンスの最適化（不要なループ削減、早期リターンの活用）",
    "エッジケースの網羅性確認（境界値テストの充実）"
  ],
  "constraints": [
    "既存テストの回帰防止（全3103テストがパスし続けること）",
    "カバレッジの低下防止（98.15%以上を維持）",
    "MF-001設計原則の維持（isContinuationLine()は変更しない）",
    "SEC-001誤検出防止ガードの維持（T11h-T11m全パス）",
    "Auto-Yes安全性の維持（誤検出による自動応答防止）",
    "API互換性の維持（detectPrompt()の引数・戻り値は変更しない）"
  ],
  "design_compliance_checklist": [
    "MF-001: Pass 2ループ内のisQuestionLikeLine()先行チェックが維持されているか",
    "SF-001: Pattern 2/4のスコープ制約コメントが維持されているか",
    "SF-002: QUESTION_SCAN_RANGE定数のJSDoc変更ガイドラインが維持されているか",
    "SF-003: findQuestionLineInRange()関数抽出が維持されているか",
    "SF-S4-001: scanRange引数の0-10クランプが維持されているか",
    "C-S4-001: ReDoS安全性アノテーションが維持されているか"
  ],
  "refactoring_scope": "既存の実装を維持しながら、コードの可読性・保守性・ドキュメントを改善する。破壊的変更は行わない。"
}
