{
  "issue_number": 31,
  "refactor_targets": [
    "src/types/sidebar.ts",
    "src/lib/db.ts",
    "src/app/api/worktrees/[id]/viewed/route.ts",
    "src/contexts/WorktreeSelectionContext.tsx"
  ],
  "quality_metrics": {
    "before_coverage": 100.0,
    "test_count": 982
  },
  "improvement_goals": [
    "コードの可読性向上",
    "重複コードの削除（必要に応じて）",
    "エラーハンドリングの改善",
    "カバレッジ維持（80%以上）"
  ],
  "completed_implementation": {
    "g1_waiting_color": "SF1で実装済み",
    "g2_hasunread_logic": "calculateHasUnread関数として実装",
    "g3_db_schema": "migration version 11",
    "g4_viewed_api": "PATCH endpoint",
    "g5_lastAssistantMessageAt": "サブクエリ方式",
    "g6_frontend_integration": "markAsViewed呼び出し"
  },
  "notes": [
    "全受入条件がパスしている状態",
    "大きな変更は不要、軽微な改善のみ"
  ]
}
