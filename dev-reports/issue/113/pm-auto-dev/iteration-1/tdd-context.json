{
  "issue_number": 113,
  "issue_title": "server.tsをビルド済みJSに変換してtsxランタイム依存を解消",
  "design_doc_path": "dev-reports/design/issue-113-server-build-design-policy.md",
  "work_plan_path": "dev-reports/issue/113/work-plan.md",
  "acceptance_criteria": [
    "npm install -g commandmate でインストール後、commandmate startが正常に動作する",
    "tsxがdevDependenciesのままで動作する",
    "開発モード（npm run dev）が引き続き動作する",
    "全テストがパスする",
    "パッケージサイズが許容範囲内（目安: 50MB以下）",
    "ci-pr.ymlでbuild:serverが検証される",
    "publish.ymlでbuild:serverが実行される"
  ],
  "implementation_tasks": [
    {
      "phase": 1,
      "name": "TypeScript設定",
      "tasks": [
        "tsconfig.base.json新規作成（共通compilerOptions）",
        "tsconfig.server.json新規作成（server.ts用ビルド設定、includeリストに全依存ファイルを含める）",
        "tsconfig.cli.json更新（extends base、paths: {}でオーバーライド）"
      ]
    },
    {
      "phase": 2,
      "name": "依存関係・スクリプト更新",
      "tasks": [
        "tsc-alias@~1.8.16をdevDependenciesに追加",
        "package.jsonのscripts更新（build:server, build:all, start, prepublishOnly）",
        "package.jsonのfiles更新（.next/, public/追加、src/除外）",
        ".npmignoreファイル作成（src/の二重保護）"
      ]
    },
    {
      "phase": 3,
      "name": "CI/CD更新",
      "tasks": [
        "ci-pr.ymlにbuild:serverステップ追加",
        "publish.ymlにbuild:serverステップとパッケージサイズ計測追加"
      ]
    },
    {
      "phase": 4,
      "name": "ドキュメント更新",
      "tasks": [
        "CLAUDE.mdにbuild:serverコマンド追記",
        "README.mdのインストール手順に影響がないことを確認"
      ]
    }
  ],
  "target_coverage": 80,
  "key_files": {
    "new_files": [
      "tsconfig.base.json",
      "tsconfig.server.json",
      ".npmignore"
    ],
    "modified_files": [
      "tsconfig.cli.json",
      "package.json",
      ".github/workflows/ci-pr.yml",
      ".github/workflows/publish.yml",
      "CLAUDE.md"
    ],
    "build_output": [
      "dist/server/server.js"
    ]
  },
  "server_ts_dependencies": {
    "direct": [
      "server.ts",
      "src/lib/env.ts",
      "src/lib/ws-server.ts",
      "src/lib/worktrees.ts",
      "src/lib/db.ts",
      "src/lib/db-instance.ts",
      "src/lib/db-migrations.ts",
      "src/lib/response-poller.ts"
    ],
    "indirect": [
      "src/lib/cli-session.ts",
      "src/lib/prompt-detector.ts",
      "src/lib/conversation-logger.ts",
      "src/lib/claude-output.ts",
      "src/lib/cli-patterns.ts",
      "src/lib/cli-tools/**/*.ts",
      "src/types/**/*.ts"
    ],
    "files_using_alias": [
      "src/lib/worktrees.ts",
      "src/lib/db.ts",
      "src/types/models.ts"
    ]
  }
}
