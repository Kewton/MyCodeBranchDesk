[English](./en/implementation-history.md)

# 実装機能一覧

各Issueの詳細（根本原因、修正方針、セキュリティ対策、テスト等）は設計書リンクを参照。

| Issue | 種別 | 概要 | 主要変更ファイル | 設計書 |
|-------|------|------|-----------------|--------|
| #368 | feat | エージェント設定UI・Gemini/Vibe-Local対応（worktree毎に2エージェント選択、ターミナルタブ動的切替、Gemini CLI対話REPL・trustフォルダ自動応答、Vibe-Local CLI Ollama連携・モデル選択、スケジュール実行gemini/vibe-local対応、selected_agents/vibe_local_modelカラム追加） | `cli-tools/types.ts`, `cli-tools/vibe-local.ts`, `selected-agents-validator.ts`, `AgentSettingsPane.tsx`, `NotesAndLogsPane.tsx`, `WorktreeDetailRefactored.tsx`, `claude-executor.ts`, `schedule-config.ts`, `cmate-parser.ts`, `schedule-manager.ts`, `db-migrations.ts`, `worktrees/[id]/route.ts` | [link](../dev-reports/design/issue-368-agent-settings-design-policy.md) |
| #294 | feat | スケジュール実行の登録（CMATE.md ## Schedulesセクションでcron定義→claude -p自動実行、execution_logs DBに結果保存、NotesAndLogsPane UIでメモ+実行ログ表示、env-sanitizer.tsでSENSITIVE_ENV_KEYS一元管理、PRAGMA foreign_keys = ON、v17マイグレーション孤児クリーンアップ） | `env-sanitizer.ts`, `cmate-parser.ts`, `types/cmate.ts`, `claude-executor.ts`, `schedule-manager.ts`, `config/schedule-config.ts`, `db-instance.ts`, `db-migrations.ts`, `session-cleanup.ts`, `server.ts`, `schedules/route.ts`, `schedules/[scheduleId]/route.ts`, `execution-logs/route.ts`, `execution-logs/[logId]/route.ts`, `NotesAndLogsPane.tsx`, `ExecutionLogPane.tsx`, `WorktreeDetailRefactored.tsx`, `locales/*/schedule.json` | [link](../dev-reports/design/issue-294-schedule-execution-design-policy.md) |
| #343 | feat | スラッシュコマンドセレクターで .claude/skills も表示（loadSkills()追加、safeParseFrontmatter()でgray-matter RCE対策、deduplicateByName()でcommand優先重複排除、skillsCache独立管理、CATEGORY_ORDER/CATEGORY_LABELS/'skill'追加、sources.skill APIレスポンス） | `slash-commands.ts`, `types/slash-commands.ts`, `command-merger.ts`, `api/worktrees/[id]/slash-commands/route.ts` | [link](../dev-reports/design/issue-343-skills-loader-design-policy.md) |
| #332 | feat | IP制限オプション（CM_ALLOWED_IPS/CM_TRUST_PROXY環境変数、CIDR対応、Edge Runtime互換、parseAllowedIps/getAllowedRanges/isIpAllowed/normalizeIp/isIpRestrictionEnabled/getClientIp、MAX_ALLOWED_IP_ENTRIES=256/MAX_CIDR_ENTRY_LENGTH=18 DoS防御、モジュールスコープキャッシュ、middleware統合） | `ip-restriction.ts`, `auth-config.ts`, `middleware.ts` | - |
| #331 | feat | トークン認証・HTTPS対応（SHA-256ハッシュ認証、Cookie/レート制限、TLS証明書、Edge Runtime互換ミドルウェア、WebSocket認証、ログインUI） | `auth.ts`, `auth-config.ts`, `middleware.ts`, `ws-server.ts`, `server.ts`, `start.ts`, `login/page.tsx`, `login/route.ts`, `logout/route.ts`, `status/route.ts` | [link](../dev-reports/design/issue-331-token-auth-design-policy.md) |
| #323 | refactor | pollAutoYes()リファクタリング（関数群方式による責務分割、validatePollingContext/captureAndCleanOutput/processStopConditionDelta/detectAndRespondToPrompt抽出、getPollerState内部ヘルパー追加、機能変更なし） | `auto-yes-manager.ts`, `auto-yes-manager.test.ts` | [link](../dev-reports/design/issue-323-auto-yes-manager-refactoring-design-policy.md) |
| #304 | fix | テスト実行時NODE_ENV分離（package.jsonに NODE_ENV=test プレフィックス追加、env.test.tsにcleanEnvVars()ヘルパー追加でファイルレベルbeforeEach/afterEachに集約、worktree-path-validator.test.tsにALLOWED_WORKTREE_PATHS delete追加） | `package.json`, `tests/unit/env.test.ts`, `tests/unit/lib/worktree-path-validator.test.ts` | [link](../dev-reports/design/issue-304-test-env-isolation-design-policy.md) |
| #314 | feat | Auto-YesにStop条件（正規表現）追加（safe-regex2 ReDoS対策、executeRegexWithTimeout 100msタイムアウト保護、disableAutoYes()専用関数、checkStopCondition()独立関数、AutoYesToggleParamsオブジェクト引数パターン、トースト通知） | `auto-yes-config.ts`, `auto-yes-manager.ts`, `auto-yes/route.ts`, `current-output/route.ts`, `AutoYesConfirmDialog.tsx`, `AutoYesToggle.tsx`, `WorktreeDetailRefactored.tsx`, `locales/*/autoYes.json` | [link](../dev-reports/design/issue-314-auto-yes-stop-condition-design-policy.md) |
| #299 | fix | iPad/スマホ レイアウト崩れ・全画面表示不具合修正（z-index体系統一、scrollable要素内スワイプ抑制、MOBILE_BREAKPOINT定数化） | `z-index.ts`, `Modal.tsx`, `Toast.tsx`, `ContextMenu.tsx`, `useSwipeGesture.ts`, `MarkdownEditor.tsx`, `SearchBar.tsx`, `z-index.test.ts`, `useSwipeGesture.test.ts` | [link](../dev-reports/design/issue-299-ipad-layout-fix-design-policy.md) |
| #287 | fix | promptCheck再検証失敗時のフォールバック不備修正（promptType/defaultOptionNumber送信、buildPromptResponseBody()共通化、100%カバレッジ達成） | `prompt-response/route.ts`, `prompt-response-body-builder.ts`, `WorktreeDetailRefactored.tsx`, `useAutoYes.ts`, `prompt-response-verification.test.ts`, `useAutoYes.test.ts`, `worktree-detail-integration.test.tsx` | [link](../dev-reports/issue/287/issue-review/) |
| #266 | fix | ブラウザタブ切替時の入力内容クリア修正（軽量リカバリパターン、setError(null)対策、コンポーネントツリー維持） | `WorktreeDetailRefactored.tsx`, `WorktreeDetailRefactored.test.tsx`, `issue-266-acceptance.test.tsx` | [link](../dev-reports/design/issue-266-visibility-change-input-clear-design-policy.md) |
| #270 | fix | update-checkルート静的プリレンダリング修正（force-dynamic追加、リグレッション防止テスト） | `update-check/route.ts`, `update-check.test.ts` | [link](../dev-reports/design/issue-270-update-check-static-prerender-design-policy.md) |
| #264 | feat | ユーザーからの問い合わせリンク（FeedbackSection UI、issue/docs CLIコマンド、gh CLI統合、GitHub URL一元管理、AIツール統合ガイド） | `github-links.ts`, `FeedbackSection.tsx`, `issue.ts`, `docs.ts`, `docs-reader.ts`, `input-validators.ts`, `cli-dependencies.ts`, `init.ts`, `cli/index.ts` | [link](../dev-reports/design/issue-264-feedback-and-docs-design-policy.md) |
| #257 | feat | バージョンアップ通知機能（GitHub Releases API、semver比較、globalThisキャッシュ、Silent Failure、OWASP Top 10準拠、i18n対応） | `version-checker.ts`, `useUpdateCheck.ts`, `UpdateNotificationBanner.tsx`, `VersionSection.tsx`, `update-check/route.ts`, `api-client.ts`, `WorktreeDetailRefactored.tsx` | [link](../dev-reports/design/issue-257-version-update-notification-design-policy.md) |
| #256 | fix | 選択メッセージ検出精度向上（複数行質問対応、isQuestionLikeLine Pattern 2/4追加、SEC-001b上方走査、MF-001 SRP遵守、リファクタリング） | `prompt-detector.ts`, `prompt-type-guards.ts`, unit/integration tests | [link](../dev-reports/design/issue-256-multiple-choice-prompt-detection-design-policy.md) |
| #246 | fix | スマホバックグラウンド復帰時のエラー自動回復（visibilitychange、timestampガード） | `WorktreeDetailRefactored.tsx`, `WorktreeList.tsx`, `WorktreeDetailRefactored.test.tsx` | [link](../dev-reports/design/issue-246-visibility-recovery-design-policy.md) |
| #124 | feat | i18n対応（next-intl、en/ja切替UI、ドキュメント英語化） | `i18n-config.ts`, `i18n.ts`, `locale-cookie.ts`, `useLocaleSwitch.ts`, `LocaleSwitcher.tsx`, `date-locale.ts`, `locales/`, `README.md`, `docs/en/` | - |
| #212 | fix | 複数行メッセージのPasted text検知+Enter自動送信（共通ヘルパー、skipPatterns拡張） | `pasted-text-helper.ts`, `cli-patterns.ts`, `claude-session.ts`, `codex.ts`, `response-poller.ts` | [link](../dev-reports/design/issue-212-pasted-text-detection-design-policy.md) |
| #211 | feat | 履歴メッセージコピーボタン（stripAnsi利用、Toast通知） | `clipboard-utils.ts`, `ConversationPairCard.tsx`, `HistoryPane.tsx`, `WorktreeDetailRefactored.tsx` | [link](../dev-reports/design/issue-211-history-copy-button-design-policy.md) |
| #201 | feat | Trust dialog自動応答（Claude CLI v2.x） | `claude-session.ts`, `cli-patterns.ts` | [link](../dev-reports/design/issue-201-trust-dialog-auto-response-design-policy.md) |
| #188 | fix | Thinking誤検出によるスピナー残留修正（5行ウィンドウ化、末尾空行トリム、インデント質問対応） | `status-detector.ts`, `response-poller.ts`, `current-output/route.ts`, `prompt-detector.ts` | [link](../dev-reports/design/issue-188-thinking-indicator-false-detection-design-policy.md) |
| #193 | fix | 複数選択肢プロンプト検出（DetectPromptOptions, requireDefaultIndicator） | `prompt-detector.ts`, `cli-patterns.ts`, `response-poller.ts` | [link](../dev-reports/design/issue-193-multiple-choice-prompt-detection-design-policy.md) |
| #191 | fix | Auto-Yes detectThinking()ウィンドウイング（末尾50行） | `auto-yes-manager.ts` | [link](../dev-reports/design/issue-191-auto-yes-thinking-windowing-design-policy.md) |
| #190 | fix | リポジトリ削除後のSync All復活防止（enabled=0除外） | `db-repository.ts`, repositories API routes | [link](../dev-reports/design/issue-190-repository-exclusion-on-sync-design-policy.md) |
| #159 | feat | infoタブにアプリバージョン表示 | `next.config.js`, `WorktreeDetailRefactored.tsx` | [link](../dev-reports/design/issue-159-info-tab-app-version-design-policy.md) |
| #180 | fix | ステータス表示の不整合修正（15行ウィンドウイング） | `status-detector.ts`, worktrees route.ts x2 | [link](../dev-reports/design/issue-180-status-display-inconsistency-design-policy.md) |
| #161 | fix | Auto-Yes番号付きリスト誤検出防止（2パス❯検出、連番検証） | `prompt-detector.ts`, `auto-yes-manager.ts` | [link](../dev-reports/design/issue-161-auto-yes-false-positive-design-policy.md) |
| #151 | fix | worktree-cleanupサーバー検出改善（ポートベース検出） | `.claude/lib/process-utils.sh`, `.claude/lib/validators.sh` | [link](../dev-reports/design/issue-151-worktree-cleanup-server-detection-design-policy.md) |
| #152 | fix | セッション初回メッセージ送信の信頼性向上（waitForPrompt） | `claude-session.ts`, `cli-patterns.ts` | [link](../dev-reports/design/issue-152-first-message-not-sent-design-policy.md) |
| #187 | fix | セッション初回メッセージ送信信頼性改善（安定化待機500ms） | `claude-session.ts` | [link](../dev-reports/design/issue-187-session-first-message-reliability-design-policy.md) |
| #123 | fix | iPadタッチ長押しコンテキストメニュー（useLongPressフック） | `useLongPress.ts`, `useContextMenu.ts`, `FileTreeView.tsx` | [link](../dev-reports/design/issue-123-ipad-touch-context-menu-design-policy.md) |
| #138 | feat | サーバー側Auto-Yesポーリング（バックグラウンドタブ対応） | `auto-yes-manager.ts`, `auto-yes-resolver.ts` | [link](../dev-reports/design/issue-138-server-side-auto-yes-polling-design-policy.md) |
| #153 | fix | Auto-Yes UI状態不整合修正（globalThisパターン） | `auto-yes-manager.ts` | [link](../dev-reports/design/issue-153-auto-yes-state-inconsistency-design-policy.md) |
| #136 | feat | Git Worktree並列開発環境（--issue, --auto-port） | CLI utils/, `external-apps/db.ts` | [link](../dev-reports/design/issue-136-worktree-parallel-dev-design-policy.md) |
| #135 | fix | DBパス解決ロジック修正（グローバルインストール対応） | `db-path-resolver.ts`, `db-migration-path.ts`, `env.ts` | [link](../dev-reports/design/issue-135-db-path-resolution-design-policy.md) |
| #111 | feat | Gitブランチ可視化（不一致警告、定期更新） | `git-utils.ts`, `BranchMismatchAlert.tsx` | [link](../dev-reports/design/issue-111-branch-visualization-design-policy.md) |
| #21 | feat | ファイルツリー検索（名前/内容検索切替） | `file-search.ts`, `SearchBar.tsx`, `useFileSearch.ts` | [link](../dev-reports/design/issue-21-file-search-design-policy.md) |
| #114 | docs | npm install -g ドキュメント整備 | README.md, docs/ | - |
| #96 | feat | npm CLIサポート（init/start/stop/status） | `src/cli/` | [link](../dev-reports/design/issue-96-npm-cli-design-policy.md) |
| #119 | feat | commandmate init 対話形式対応 | `cli/commands/init.ts`, `cli/utils/prompt.ts` | - |
| #125 | fix | グローバルインストール時の.env読み込み修正 | `cli/utils/env-setup.ts`, `cli/utils/daemon.ts` | [link](../dev-reports/design/issue-125-global-install-env-loading-design-policy.md) |
| #100 | feat | Mermaidダイアグラム描画（securityLevel=strict） | `MermaidDiagram.tsx`, `mermaid-config.ts` | [link](../dev-reports/design/issue-100-mermaid-diagram-design-policy.md) |
| #95 | feat | 画像ファイルビューワ（マジックバイト/SVG XSS検証） | `image-extensions.ts`, `ImageViewer.tsx` | [link](../dev-reports/design/issue-95-image-viewer-design-policy.md) |
| #94 | feat | ファイルアップロード（5MB制限、マジックバイト検証） | `uploadable-extensions.ts`, upload API route | [link](../dev-reports/design/issue-94-file-upload-design-policy.md) |
| #113 | feat | server.tsビルド済みJS変換（tsx依存解消） | `tsconfig.server.json`, `dist/server/` | [link](../dev-reports/design/issue-113-server-build-design-policy.md) |
| #112 | fix | サイドバートグルパフォーマンス改善（transform方式） | `AppShell.tsx`, `z-index.ts` | [link](../dev-reports/design/issue-112-sidebar-transform-design-policy.md) |
| #99 | feat | マークダウンエディタ表示改善（最大化/リサイズ） | `useFullscreen.ts`, `useLocalStorageState.ts` | [link](../dev-reports/design/issue-99-markdown-editor-display-improvement-design-policy.md) |
| #49 | feat | マークダウンエディタとビューワー | `MarkdownEditor.tsx`, `file-operations.ts` | [link](../dev-reports/design/issue-49-markdown-editor-design-policy.md) |
| #77 | chore | CommandMateリネーム Phase 3（CM_*名称統一） | `env.ts`, `.env.example`, `package.json` | [link](../dev-reports/design/issue-77-rename-phase3-design-policy.md) |
| #76 | feat | 環境変数フォールバック（CM_*/MCBD_*両対応） | `env.ts` | [link](../dev-reports/design/issue-76-env-fallback-design-policy.md) |
| #71 | feat | クローンURL登録（非同期ジョブ、URL正規化） | `clone-manager.ts`, `url-normalizer.ts` | [link](../dev-reports/design/issue-71-clone-url-registration-design-policy.md) |
| #69 | feat | リポジトリ削除（Facadeパターン、確認ダイアログ） | `session-cleanup.ts`, repositories API | [link](../dev-reports/design/issue-69-repository-delete-design-policy.md) |
| #31 | feat | サイドバーUX改善（リアルタイムステータス検出） | status-detector, sidebar components | [docs](../docs/features/sidebar-status-indicator.md) |
| #22 | feat | マルチタスクサイドバー（2カラム、ソート機能） | sidebar components | - |
| #4 | feat | CLIツールサポート（Codex CLI追加、Strategyパターン） | `cli-tools/`, `cli-patterns.ts`, `standard-commands.ts` | [link](../dev-reports/design/issue-4-codex-cli-support-design-policy.md) |
