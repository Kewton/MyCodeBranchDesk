# Webアプリ基本操作ガイド

CommandMate のWebアプリを使った基本操作を説明します。
初めてアプリを使う方向けの手順書です。

> **技術者向け詳細**: UI実装の詳細は [UI/UXガイド](../UI_UX_GUIDE.md) を参照してください。

---

## 目次

1. [アプリの起動とアクセス](#アプリの起動とアクセス)
2. [リポジトリの登録](#リポジトリの登録)
3. [リポジトリの削除](#リポジトリの削除)
4. [ワークツリーの選択](#ワークツリーの選択)
5. [メッセージの送信](#メッセージの送信)
6. [Auto Yesモード](#auto-yesモード)
7. [チャット履歴の確認](#チャット履歴の確認)
8. [ステータスインジケーター](#ステータスインジケーター)
9. [Markdownログビューア](#markdownログビューア)
10. [メモ機能](#メモ機能)
11. [モバイルからのアクセス](#モバイルからのアクセス)

---

## アプリの起動とアクセス

### 1. サーバーの起動

#### npm グローバルインストールの場合（推奨）

```bash
# バックグラウンドで起動
commandmate start --daemon

# ステータス確認
commandmate status

# 停止
commandmate stop
```

#### 開発環境（git clone）の場合

```bash
cd CommandMate

# 開発サーバー
npm run dev

# 本番ビルド
npm run build
npm start
```

> **Note**: 初めて使う場合は `commandmate init` で初期設定を行ってください。詳しくは [CLI セットアップガイド](./cli-setup-guide.md) を参照してください。

### 2. ブラウザでアクセス

ブラウザで以下のURLにアクセスします:

```
http://localhost:3000
```

> **ポート変更**: `commandmate start --port 3001` または `.env` ファイルで `CM_PORT=3001` のように変更できます。

---

## リポジトリの登録

CommandMate でワークツリーを管理するには、まずリポジトリを登録します。
登録方法は2つあります。

### 方法1: ローカルパスからスキャン

PC上の既存リポジトリをスキャンして登録します。

1. トップページ右上の **「リポジトリを追加」** ボタンをクリック
2. **「ローカルパス」** タブを選択
3. リポジトリのパスを入力（例: `/Users/yourname/projects/my-repo`）
4. **「スキャン」** をクリック
5. 検出されたワークツリー一覧を確認し、**「登録」** をクリック

### 方法2: URLからクローン

GitHub等のリモートリポジトリをクローンして登録します。

1. トップページ右上の **「リポジトリを追加」** ボタンをクリック
2. **「URLクローン」** タブを選択
3. リポジトリURLを入力
   - HTTPS: `https://github.com/username/repo.git`
   - SSH: `git@github.com:username/repo.git`
4. **「クローン」** をクリック
5. クローン完了後、自動的にワークツリーが登録されます

> **注意**: SSH URLを使用する場合は、SSH鍵がセットアップされている必要があります。

---

## リポジトリの削除

不要になったリポジトリを削除できます。

1. トップページのリポジトリ一覧で、削除したいリポジトリの **「⋯」** メニューをクリック
2. **「削除」** を選択
3. 確認ダイアログで `delete` と入力
4. **「削除」** ボタンをクリック

> **警告**: 削除すると、関連するワークツリー情報・メモ・履歴もすべて削除されます。リポジトリのファイル自体は削除されません。

---

## ワークツリーの選択

登録したリポジトリのワークツリー（ブランチ）を選択して操作します。

### デスクトップの場合

1. 左側のサイドバーにワークツリー一覧が表示されます
2. 操作したいワークツリーをクリック
3. 右側に詳細画面が表示されます

### モバイルの場合

1. トップページにワークツリー一覧が表示されます
2. 操作したいワークツリーをタップ
3. ワークツリー詳細画面に移動します

![デスクトップ表示](../images/screenshot-worktree-desktop.png)
*デスクトップ: 2カラムレイアウト*

![モバイル表示](../images/screenshot-worktree-mobile.png)
*モバイル: タブベースレイアウト*

---

## メッセージの送信

Claude Code にメッセージを送信して指示を出します。

### 送信手順

1. ワークツリーを選択
2. 画面下部の入力欄にメッセージを入力
3. **「送信」** ボタンをクリック（または Enter キー）

### Claude からの確認への応答

Claude が yes/no や選択肢の確認を求めてきた場合:

1. 確認ダイアログが自動的に表示されます
2. **「Yes」** または **「No」** をクリック
3. 複数選択の場合は、選択肢をクリックして回答

![モバイル Terminal](../images/screenshot-worktree-mobile-terminal.png)
*モバイル: Terminal タブでのメッセージ送信*

---

## Auto Yesモード

Claude からの確認を自動的に承認するモードです。
連続した処理を中断なく実行したい場合に便利です。

### 使い方

1. ワークツリー詳細画面を開く
2. 画面上部の **「Auto Yes」** トグルをオンにする
3. 確認ダイアログが表示される
4. **有効時間を選択**（1時間 / 3時間 / 8時間）
   - デフォルトは **1時間** です
   - 作業に必要な最小限の時間を選択してください
5. 選択した時間に応じて説明文が動的に変わります（例：「3時間後に自動でOFFになります。」）
6. **「同意して有効化」** をクリック

### 有効時間

| 選択肢 | ミリ秒値 | 想定ユースケース |
|--------|---------|---------------|
| **1時間**（デフォルト） | 3,600,000 | 通常の開発作業、短時間のタスク |
| **3時間** | 10,800,000 | 中規模の実装作業 |
| **8時間** | 28,800,000 | 長時間のバッチ処理的タスク（定期的な進捗確認を推奨） |

カウントダウンタイマーにより残り時間が常時表示されます。
- **1時間未満**: `MM:SS` 形式（例: `45:30`）
- **1時間以上**: `H:MM:SS` 形式（例: `2:15:30`）

### API仕様（開発者向け）

Auto-Yes有効化APIは以下のパラメータを受け付けます：

```typescript
POST /api/worktrees/:id/auto-yes

{
  "enabled": true,
  "duration": 3600000 | 10800000 | 28800000  // オプショナル（デフォルト: 3600000）
}
```

- **duration省略時**: デフォルトで1時間（3,600,000ミリ秒）が適用されます（後方互換性）
- **不正なduration値**: 400エラーが返されます
- **セキュリティ**: worktreeIdフォーマット検証 → JSON parse検証 → 型検証 → ホワイトリスト検証の5層防御

### 注意事項

- Auto Yes が有効な間、すべての確認に自動で「Yes」と回答します
- 重要な変更（ファイル削除など）も自動承認されるため、注意して使用してください
- 必要に応じてトグルをオフにして無効化できます
- 選択した有効時間が経過すると自動でOFFになります
- **セキュリティのベストプラクティス**:
  - 作業に必要な **最小限の時間** を選択する（迷った場合は1時間を推奨）
  - `CM_ROOT_DIR` を作業対象のworktreeディレクトリに限定する
  - 長時間離席する場合は、残り時間に関わらず手動でOFFにする
  - 詳細は [Trust & Safety](../TRUST_AND_SAFETY.md#auto-yes-有効時間に関するリスクと推奨事項) を参照

---

## チャット履歴の確認

過去のメッセージ履歴を確認できます。

### デスクトップの場合

左ペインの **History Pane** に履歴が表示されます。
- ユーザーのメッセージと Claude の応答が時系列で表示
- スクロールで過去の履歴を確認

### モバイルの場合

画面下部のタブバーから **「History」** タブをタップします。
- 過去のやり取りを一覧表示
- タップで詳細を確認

---

## ステータスインジケーター

サイドバーの各ワークツリーに表示されるインジケーターで、現在の状態がわかります。

| 表示 | ステータス | 意味 |
|------|-----------|------|
| ● グレー | idle | セッション未起動 |
| ● 緑 | ready | 入力待ち（新しいメッセージを送信可能） |
| ⟳ 青スピナー | running | Claude が処理中 |
| ● 黄 | waiting | ユーザー入力待ち（yes/no 確認など） |
| ⟳ 青スピナー | generating | レスポンス生成中 |

> **詳細**: ステータス検出の仕組みについては [ステータスインジケーター詳細](../features/sidebar-status-indicator.md) を参照してください。

---

## Markdownログビューア

Claude の詳細な出力をMarkdown形式で閲覧できます。

### モバイルの場合

1. 画面下部のタブバーから **「Logs」** タブをタップ
2. ログファイル一覧から閲覧したいファイルをタップ
3. Markdown形式でレンダリングされた内容を確認

### デスクトップの場合

1. **「Info」** ボタンをクリックしてモーダルを開く
2. ログファイル一覧から選択して閲覧

---

## メモ機能

各ワークツリーにメモを保存できます。
作業内容や TODO を記録するのに便利です。

### メモの編集

#### デスクトップの場合

1. 画面右上の **「Info」** ボタンをクリック
2. モーダル内の **「メモ」** セクションで編集
3. 入力内容は自動保存されます

#### モバイルの場合

1. 画面下部のタブバーから **「Info」** タブをタップ
2. **「メモ」** セクションで編集
3. 入力内容は自動保存されます

---

## モバイルからのアクセス

スマートフォンから CommandMate にアクセスする方法です。

### 同一LAN内からのアクセス

1. PCとスマートフォンを同じWi-Fiに接続
2. `.env` ファイルを編集:
   ```
   CM_BIND=0.0.0.0
   ```
3. サーバーを再起動
4. スマートフォンのブラウザで `http://<PCのIPアドレス>:3000` にアクセス

> **注意**: 外部ネットワークへの公開時はリバースプロキシでの認証を推奨します。詳細は [セキュリティガイド](../security-guide.md) を参照してください。

### PCのIPアドレスの確認方法

```bash
# macOS
ifconfig | grep "inet " | grep -v 127.0.0.1

# Linux
ip addr | grep "inet " | grep -v 127.0.0.1
```

### 外出先からのアクセス

Cloudflare Tunnel などのトンネリングサービスを使用することで、外出先からもアクセスできます。
詳しくは [デプロイガイド](../DEPLOYMENT.md) を参照してください。

### モバイルUI

モバイルでは画面下部にタブバーが表示されます:

| タブ | 内容 |
|------|------|
| **Terminal** | リアルタイム出力 + メッセージ入力 |
| **History** | チャット履歴 |
| **Logs** | Markdownログ一覧 |
| **Info** | ワークツリー情報 + メモ |

![モバイル表示](../images/screenshot-mobile.png)
*モバイル: トップページ*

---

## 関連ドキュメント

- [CLI セットアップガイド](./cli-setup-guide.md) - インストールと初期設定
- [UI/UXガイド](../UI_UX_GUIDE.md) - UI実装の技術詳細
- [ステータスインジケーター詳細](../features/sidebar-status-indicator.md) - ステータス検出の仕組み
- [デプロイガイド](../DEPLOYMENT.md) - 本番環境構築手順
- [コンセプト](../concept.md) - CommandMate のビジョン
