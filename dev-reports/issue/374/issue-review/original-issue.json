{"body":"## 背景\n\nVibe Local選択時、現在はOllamaのモデル（`-m` オプション）のみ指定可能だが、`--context-window` によるコンテキスト長の指定もサポートしたい。\n\nコンテキストウィンドウサイズはモデルの応答品質やメモリ使用量に直結する重要なパラメータであり、ユーザーがworktree単位で調整できるようにする。\n\n## 現状\n\n- `vibe-local -y -m {model}` でセッション起動（`src/lib/cli-tools/vibe-local.ts`）\n- モデル選択はDB（`vibe_local_model` カラム）に永続化し、AgentSettingsPaneのUIから変更可能\n- コンテキストウィンドウの指定手段はない\n\n## 対応方針\n\nモデル選択と同様のパターン（DB永続化 + UI + API + CLIオプション）で実装する。\n\n### 1. データベース\n\n- `worktrees` テーブルに `vibe_local_context_window INTEGER DEFAULT NULL` カラムを追加（マイグレーション）\n- `NULL` = vibe-localデフォルト値を使用\n\n### 2. API（PATCH /api/worktrees/[id]）\n\n- `vibeLocalContextWindow` フィールドを受け付ける\n- バリデーション: `null`（リセット）または正の整数（例: 1024〜131072）\n- 既存の `vibeLocalModel` バリデーションと同じ箇所に追加\n\n### 3. UI（AgentSettingsPane）\n\n- Ollamaモデルセレクターの下にコンテキストウィンドウ入力欄を追加\n- 数値入力（`type=\"number\"`）、プレースホルダーに「Default」表示\n- 空欄 = `null`（デフォルト値を使用）\n\n### 4. セッション起動（vibe-local.ts）\n\n- DBから `vibeLocalContextWindow` を読み取り\n- 値が設定されている場合、起動コマンドに `--context-window {value}` を追加\n  - 例: `vibe-local -y -m llama3.2 --context-window 8192`\n- バリデーション: 正の整数であることを確認（defense-in-depth）\n\n## 変更対象（想定）\n\n- `src/lib/db-migrations.ts` — マイグレーション追加\n- `src/lib/db.ts` — 更新関数追加\n- `src/types/models.ts` — Worktreeインターフェースにフィールド追加\n- `src/app/api/worktrees/[id]/route.ts` — PATCHハンドラにバリデーション追加\n- `src/lib/cli-tools/vibe-local.ts` — 起動コマンド構築に `--context-window` 追加\n- `src/components/worktree/AgentSettingsPane.tsx` — UI入力欄追加\n- `locales/ja/schedule.json`, `locales/en/schedule.json` — i18nラベル追加\n\n## 受け入れ基準\n\n- [ ] AgentSettingsPaneでVibe Local選択時にコンテキストウィンドウの入力欄が表示される\n- [ ] 入力した値がDBに永続化され、ページリロード後も保持される\n- [ ] セッション起動時に `--context-window {value}` が正しくCLI引数として渡される\n- [ ] 未設定（null）の場合はオプションが省略される（vibe-localのデフォルト動作）\n- [ ] 不正な値（負数、非整数、範囲外）がバリデーションで拒否される","title":"feat: Vibe Localにコンテキストウィンドウサイズ(--context-window)の設定を追加"}
