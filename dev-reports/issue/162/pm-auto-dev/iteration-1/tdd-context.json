{
  "issue_number": 162,
  "title": "ファイル機能強化",
  "acceptance_criteria": [
    "コンテキストメニューから「移動」を選択し、移動先ディレクトリを指定してファイル/ディレクトリを移動できること",
    "移動時にパス検証（isPathSafe()）が実施され、ディレクトリトラバーサルが防止されること",
    "ファイルツリーにファイルの作成時刻が表示されること",
    "FileViewerでテキストファイルの全文をワンクリックでコピーできること",
    "コピー成功時にアイコン変更フィードバックが表示されること（Toast不使用）",
    "新規関数・APIのユニットテストが追加されていること",
    "既存テストがすべてパスすること",
    "i18n対応（en/ja）がされていること"
  ],
  "implementation_tasks": [
    "src/lib/file-operations.ts に validateFileOperation() ヘルパー関数を追加",
    "src/lib/file-operations.ts に moveFileOrDirectory() 関数を追加（セキュリティチェック5項目含む）",
    "src/lib/file-operations.ts の renameFileOrDirectory() を validateFileOperation() 使用にリファクタリング",
    "src/types/models.ts の TreeItem に birthtime フィールドを追加",
    "src/lib/file-tree.ts の readDirectory() で birthtime 取得",
    "src/lib/date-utils.ts を新規作成し formatRelativeTime() を実装",
    "src/app/api/worktrees/[id]/files/[...path]/route.ts の PATCH に action: move 追加",
    "src/hooks/useFileOperations.ts を新規作成",
    "src/components/worktree/MoveDialog.tsx を新規作成",
    "src/components/worktree/ContextMenu.tsx に Move メニュー項目を追加",
    "src/components/worktree/FileTreeView.tsx に時刻表示を追加",
    "src/components/worktree/FileViewer.tsx にコピーボタンを追加",
    "src/components/worktree/WorktreeDetailRefactored.tsx に useFileOperations() を統合",
    "locales/en/worktree.json と locales/ja/worktree.json に fileTree セクションを追加",
    "locales/en/error.json と locales/ja/error.json に fileOps.failedToMove を追加"
  ],
  "security_requirements": [
    "SEC-005: ソースパスの保護ディレクトリチェック（.git, node_modules 等）- 重大",
    "SEC-006: シンボリックリンク検証（realpathSync() 使用）",
    "SEC-007: MOVE_INTO_SELF チェック（パスセパレーター含む）",
    "SEC-008: 最終移動先パスの isPathSafe() 検証",
    "SEC-009: TOCTOU 防御（EEXIST/ENOTEMPTY エラーハンドリング）"
  ],
  "target_coverage": 80,
  "design_policy_path": "dev-reports/design/issue-162-file-enhancement-design-policy.md",
  "work_plan_path": "dev-reports/issue/162/work-plan.md"
}
