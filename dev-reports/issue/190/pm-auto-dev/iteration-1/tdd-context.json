{
  "issue_number": 190,
  "acceptance_criteria": [
    "UIで削除したリポジトリがSync Allで復活しないこと",
    "環境変数に設定されたリポジトリでも除外が有効であること",
    "CM_ROOT_DIR設定時でも除外が有効であること",
    "複数リポジトリの一部削除→Sync Allで未削除リポジトリは正常同期されること",
    "除外したリポジトリを再度登録（復活）できること",
    "復活操作後、手動Sync All不要でworktreesテーブルが自動復元されること",
    "削除確認ダイアログに除外される旨と復活方法が明示されていること",
    "環境変数リポジトリがpath.resolve()で正規化された上でrepositoriesテーブルに登録されること",
    "復活APIのエラーハンドリングが適切に実装されていること（404, warning付き200, 500）",
    "既存テストがすべてパスすること"
  ],
  "implementation_tasks": [
    "Phase 1: データアクセス層 - resolveRepositoryPath()ヘルパー関数をsrc/lib/db-repository.tsに追加",
    "Phase 1: データアクセス層 - getExcludedRepositoryPaths(), getExcludedRepositories(), disableRepository(), restoreRepository(), ensureEnvRepositoriesRegistered(), filterExcludedPaths()をsrc/lib/db-repository.tsに追加",
    "Phase 2: DELETE /api/repositories修正 - パストラバーサルバリデーション追加、disableRepository()呼び出しをworktreeIdsチェック前に配置",
    "Phase 2: POST /api/repositories/sync修正 - ensureEnvRepositoriesRegistered()呼び出し追加、filterExcludedPaths()による除外フィルタリング追加",
    "Phase 3: GET /api/repositories/excluded新規作成 - 除外リポジトリ一覧取得API",
    "Phase 3: PUT /api/repositories/restore新規作成 - パストラバーサルバリデーション、restoreRepository() + scanWorktrees() + syncWorktreesToDB()自動実行",
    "Phase 4: api-client.ts拡張 - repositoryApiにgetExcluded(), restore()メソッド追加",
    "Phase 4: WorktreeList.tsx修正 - 削除確認ダイアログ更新、isInEnvVar()廃止、除外リポジトリ一覧セクション追加",
    "Phase 5: ユニットテスト - tests/unit/lib/db-repository-exclusion.test.ts新規作成",
    "Phase 5: 既存テスト更新 - tests/integration/api-repository-delete.test.ts修正",
    "Phase 5: セキュリティテスト - null byte, システムディレクトリ, MAX_DISABLED_REPOSITORIES",
    "Phase 5: 統合テスト - tests/integration/repository-exclusion.test.ts新規作成"
  ],
  "design_policy_path": "dev-reports/design/issue-190-repository-exclusion-on-sync-design-policy.md",
  "work_plan_path": "dev-reports/issue/190/work-plan.md",
  "target_coverage": 80
}
